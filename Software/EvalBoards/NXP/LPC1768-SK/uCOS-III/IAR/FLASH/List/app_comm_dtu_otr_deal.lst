###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.1.10123/W32 for ARM       09/Oct/2017  13:11:23
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_dtu_otr_deal.c
#    Command line =  
#        F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_dtu_otr_deal.c
#        -lCN
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List
#        --diag_suppress Pa050 -o
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M3 -e --fpu=None --dlib_config "C:\Program Files
#        (x86)\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Normal.h" -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\OS\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\LPC1768\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\Generic\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\CSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-LIB\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\ARM-Cortex-M3\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Cfg\Template\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Os\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\OS\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\Ports\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Iap\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Protocol\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Tasks\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\AES\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\OS\OSAL\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\CSB\include\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\MX25L1602Drv\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\OCM800600T80\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\CardOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\DataDeal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\EquipmentOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Global\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\MastConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SlaveConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SpeedTest\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\csnr_package_deal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\iap\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\tax\
#        -On --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.3\arm\CMSIS\Include\"
#    List file    =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List\app_comm_dtu_otr_deal.lst
#    Object file  =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj\app_comm_dtu_otr_deal.o
#
###############################################################################

F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_dtu_otr_deal.c
      1          /*******************************************************************************
      2          *   Filename:       app_comm_dtu_otr_deal.c
      3          *   Revised:        All copyrights reserved to redmorningcn.
      4          *   Revision:       v1.0
      5          *   Writer:	        redmorningcn.
      6          *
      7          *   Description:    双击选中 dtu 按 Ctrl + H, 钩选 Match the case, Replace with
      8          *                   输入您要的名字，点击 Replace All
      9          *                   双击选中 Dtu 按 Ctrl + H, 钩选 Match the case, Replace with
     10          *                   输入您要的名字，点击 Replace All
     11          *                   双击选中 DTU 按 Ctrl + H, 钩选 Match the case, Replace with
     12          *                   输入您要的名字，点击 Replace All
     13          *                   在 app_cfg.h 中指定本任务的 优先级  （ APP_TASK_COMM_PRIO     ）
     14          *                                            和 任务堆栈（ APP_TASK_COMM_STK_SIZE ）大小
     15          *
     16          *   Notes:
     17          *     				E-mail: redmorningcn@qq.com
     18          *
     19          *******************************************************************************/
     20          
     21          /*******************************************************************************
     22          * INCLUDES
     23          */
     24          #define  SNL_APP_SOURCE
     25          #include <includes.h>
     26          #include <app_comm_protocol.h>
     27          #include <app_ctrl.h>
     28          #include <app.h>
     29          #include <os_cfg_app.h>
     30          #include <OperateCard.h>
     31          
     32          
     33          #ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
     34          const  CPU_CHAR  *app_comm_dtu_otr__c = "$Id: $";
     35          #endif
     36          
     37          #define APP_TASK_COMM_EN     DEF_ENABLED
     38          #if APP_TASK_COMM_EN == DEF_ENABLED
     39          /*******************************************************************************
     40          * CONSTANTS
     41          */
     42          
     43          /*******************************************************************************
     44          * MACROS
     45          */
     46          #define CYCLE_TIME_TICKS            (OS_TICKS_PER_SEC * 1)
     47          
     48          /*******************************************************************************
     49          * TYPEDEFS
     50          */
     51          
     52          #define		DATA_CARD           0x0001			//数据卡-----暂时未用
     53          #define		DENSITY_CARD		0x0020			//密度卡
     54          #define		MODEL_CARD			0x0040			//模型卡-----暂时未用
     55          #define		TIME_CARD           0x0100			//时间卡-----
     56          #define		COM_MODEL_CARD	    0x0100		    //串口模型卡-暂时未用
     57          #define		HIGHT_CARD			0x0200			//高度卡-----
     58          #define		COPY_CARD           0x0400			//复制卡-----暂时未用
     59          #define		MODEL_SELECT_CARD	0x1000			//模型选择卡-
     60          #define		FIX_CARD            0x2000			//装车卡-----
     61          #define		COPY_FRAM_CARD	    0x4000			//铁电复制卡-暂时未用
     62          #define		SET_DATA_CARD		0x0080			//置数卡-----按时未用
     63          #define		DEBUG_CARD			0x0800			//调试卡-----暂时未用
     64          
     65          #define		EXPAND_CARD			0x8000			//扩展卡-----暂时未用
     66          
     67          #define		DATA_CARD_DIS		0x10000			//数据卡指示
     68          #define		DATA_CARD_FIN		0x20000			//数据卡结束
     69          #define		SYS_RUN_PARA		0x40000			//系统参数卡--暂未使用
     70          #define		CLEAR_ALL			0x80000			//清零卡，数据记录清零
     71          
     72          #define		RST_SYS				0x100000		//复位指令
     73          #define		CALC_PARA           0x200000		//计算斜率
     74          
     75          #define    OIL_BOX_MODEL_ADDR				2000    //油箱模型存储地址
     76          /*******************************************************************************
     77          * LOCAL VARIABLES
     78          */
     79          
     80          /*******************************************************************************
     81          * GLOBAL VARIABLES
     82          */
     83          
     84          /***********************************************
     85          * 描述： 软定时器声明
     86          */
     87          
     88          /***********************************************
     89          * 描述： 软定时器回调函数
     90          */
     91          
     92          
     93          /*******************************************************************************
     94          * LOCAL FUNCTIONS
     95          */
     96          uint8   comm_record_send_one(StrDevDtu * sDtu,uint8 addrnum);
     97          void    comm_record_send(StrDevDtu * sDtu,uint8 addrnum);
     98          void    comm_para_flow(StrDevDtu * sDtu,uint8 addrnum);
     99          void    Restart(void);
    100          
    101          
    102          
    103          /*******************************************************************************
    104          * GLOBAL FUNCTIONS
    105          */
    106          
    107          /*******************************************************************************
    108          * EXTERN VARIABLES
    109          */
    110          
    111          /*******************************************************************************
    112          * EXTERN FUNCTIONS
    113          */
    114          uint8   FRAM_StoreRecNumMgr(StrRecNumMgr  *SRecNumMgr);
    115          uint8   FRAM_StoreOilPara(StrOilPara  *SOilPara);
    116          void    BSP_DispClrAll(void);
    117          uint8   FRAM_StoreProductInfo(StrProductInfo  *sProductInfo);
    118          uint8   ReadFM24CL64(uint16  Addr, uint8 *DataBuf, uint32 DataBufLen);            
    119          uint8   WriteFM24CL64(uint16  Addr, uint8 *DataBuf, uint32 DataBufLen);            
    120          void    GetOilPara(void);
    121          void    SetDispNow(void);
    122          uint8   comm_tinyrec_send(StrDevOtr * sOtr,uint8    addrnum);
    123          
    124          /*******************************************************************************/
    125          
    126          extern  stcSysCtrl  sCtrl;
    127          
    128          extern  stcCalcModel    l_sCalcModel;       //临时采用的油箱模型
    129          /*******************************************************************************
    130          * 名    称： comm_para_flow
    131          * 功    能： 参数流。根据具体参数进行操作
    132          *            
    133          * 入口参数： 无线设备数据结构
    134          * 出口参数： 无
    135          * 作　 　者： redmorningcn.
    136          * 创建日期： 2017-05-19
    137          * 修    改：
    138          * 修改日期：
    139          * 备    注： 任务创建函数需要在app.h文件中声明
    140          *******************************************************************************/

   \                                 In section .text, align 4, keep-with-next
    141          void    comm_para_flow(StrDevDtu * sDtu,uint8 addrnum)
    142          {
   \                     comm_para_flow: (+1)
   \   00000000   0xE92D 0x4FF0      PUSH     {R4-R11,LR}
   \   00000004   0xB089             SUB      SP,SP,#+36
   \   00000006   0x0004             MOVS     R4,R0
   \   00000008   0x000D             MOVS     R5,R1
    143              stcTime     sTime;
    144              uint8       i = 0;
   \   0000000A   0x2700             MOVS     R7,#+0
    145              uint32      modelrecvnum =0;
   \   0000000C   0x2000             MOVS     R0,#+0
   \   0000000E   0x9005             STR      R0,[SP, #+20]
    146              uint32      tmp32;
    147              static     uint32      modelstoreaddr = 0;
    148              uint16      crc16;
    149              uint8       *p;
    150              
    151              BSP_DispClrAll();                               //清原显示值，立即显示设定值                 
   \   00000010   0x.... 0x....      BL       BSP_DispClrAll
    152              
    153              switch (sDtu->RxCtrl.DataCode)  
   \   00000014   0xF8D4 0x0148      LDR      R0,[R4, #+328]
   \   00000018   0x2801             CMP      R0,#+1
   \   0000001A   0xF000 0x81B9      BEQ.W    ??comm_para_flow_0
   \   0000001E   0x2820             CMP      R0,#+32
   \   00000020   0xD02D             BEQ.N    ??comm_para_flow_1
   \   00000022   0x2840             CMP      R0,#+64
   \   00000024   0xF000 0x8164      BEQ.W    ??comm_para_flow_2
   \   00000028   0xF5B0 0x7F80      CMP      R0,#+256
   \   0000002C   0xD038             BEQ.N    ??comm_para_flow_3
   \   0000002E   0xF5B0 0x7F00      CMP      R0,#+512
   \   00000032   0xD058             BEQ.N    ??comm_para_flow_4
   \   00000034   0xF5B0 0x5F80      CMP      R0,#+4096
   \   00000038   0xF000 0x8085      BEQ.W    ??comm_para_flow_5
   \   0000003C   0xF5B0 0x5F00      CMP      R0,#+8192
   \   00000040   0xF000 0x8092      BEQ.W    ??comm_para_flow_6
   \   00000044   0xF5B0 0x3F80      CMP      R0,#+65536
   \   00000048   0xF000 0x80A5      BEQ.W    ??comm_para_flow_7
   \   0000004C   0xF5B0 0x3F00      CMP      R0,#+131072
   \   00000050   0xF000 0x80AE      BEQ.W    ??comm_para_flow_8
   \   00000054   0xF5B0 0x2F80      CMP      R0,#+262144
   \   00000058   0xF000 0x8128      BEQ.W    ??comm_para_flow_9
   \   0000005C   0xF5B0 0x2F00      CMP      R0,#+524288
   \   00000060   0xF000 0x80B6      BEQ.W    ??comm_para_flow_10
   \   00000064   0xF5B0 0x1F80      CMP      R0,#+1048576
   \   00000068   0xF000 0x80C7      BEQ.W    ??comm_para_flow_11
   \   0000006C   0xF5B0 0x1F00      CMP      R0,#+2097152
   \   00000070   0xF000 0x80ED      BEQ.W    ??comm_para_flow_12
   \   00000074   0xF5B0 0x0F80      CMP      R0,#+4194304
   \   00000078   0xF000 0x81D3      BEQ.W    ??comm_para_flow_13
   \   0000007C   0xE236             B.N      ??comm_para_flow_14
    154              {
    155                  //设置密度
    156              case    DENSITY_CARD: 
    157                  sCtrl.SOilPara.Density = sDtu->Rd.Density;          
   \                     ??comm_para_flow_1: (+1)
   \   0000007E   0x8820             LDRH     R0,[R4, #+0]
   \   00000080   0x.... 0x....      LDR.W    R1,??DataTable2
   \   00000084   0xF8A1 0x00A4      STRH     R0,[R1, #+164]
    158                  
    159                  FRAM_StoreOilPara((StrOilPara *)&sCtrl.SOilPara);   //存数据。关键数据存储时保护
   \   00000088   0x.... 0x....      LDR.W    R0,??DataTable2_1
   \   0000008C   0x.... 0x....      BL       FRAM_StoreOilPara
    160                  
    161                  uprintf("%8d",sCtrl.SOilPara.Density);   //立即显示设定值 
   \   00000090   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000094   0xF9B0 0x10A4      LDRSH    R1,[R0, #+164]
   \   00000098   0xA0BC             ADR.N    R0,??comm_para_flow_15  ;; "%8d"
   \   0000009A   0x.... 0x....      BL       uprintf
    162                  
    163                  break;
   \   0000009E   0xE225             B.N      ??comm_para_flow_16
    164                  
    165                  //设置时间
    166              case    TIME_CARD:                
    167                  
    168                  WriteTime(sDtu->Rd.sTime);          
   \                     ??comm_para_flow_3: (+1)
   \   000000A0   0x2000             MOVS     R0,#+0
   \                     ??comm_para_flow_17: (+1)
   \   000000A2   0x5D01             LDRB     R1,[R0, R4]
   \   000000A4   0x466A             MOV      R2,SP
   \   000000A6   0x5481             STRB     R1,[R0, R2]
   \   000000A8   0x1C40             ADDS     R0,R0,#+1
   \   000000AA   0x2808             CMP      R0,#+8
   \   000000AC   0xD3F9             BCC.N    ??comm_para_flow_17
   \   000000AE   0xE9DD 0x0100      LDRD     R0,R1,[SP, #+0]
   \   000000B2   0x.... 0x....      BL       WriteTime
    169                  ReadTime((stcTime *)&sTime);
   \   000000B6   0xA806             ADD      R0,SP,#+24
   \   000000B8   0x.... 0x....      BL       ReadTime
    170                  
    171                  uprintf("%02d-%02d-%02d",sTime.Year
    172                          ,sTime.Month
    173                              ,sTime.Date
    174                                  );     
   \   000000BC   0xF89D 0x301B      LDRB     R3,[SP, #+27]
   \   000000C0   0xF89D 0x201C      LDRB     R2,[SP, #+28]
   \   000000C4   0xF89D 0x101D      LDRB     R1,[SP, #+29]
   \   000000C8   0x.... 0x....      LDR.W    R0,??DataTable2_2
   \   000000CC   0x.... 0x....      BL       uprintf
    175                  uprintf("%02d-%02d-%02d",sTime.Hour
    176                          ,sTime.Min
    177                              ,sTime.Sec
    178                                  );               
   \   000000D0   0xF89D 0x3018      LDRB     R3,[SP, #+24]
   \   000000D4   0xF89D 0x2019      LDRB     R2,[SP, #+25]
   \   000000D8   0xF89D 0x101A      LDRB     R1,[SP, #+26]
   \   000000DC   0x.... 0x....      LDR.W    R0,??DataTable2_2
   \   000000E0   0x.... 0x....      BL       uprintf
    179                  break;
   \   000000E4   0xE202             B.N      ??comm_para_flow_16
    180                  
    181                  //高度卡
    182              case    HIGHT_CARD:  
    183                  //高度值可以累计
    184                  sCtrl.SOilPara.Hig += sDtu->Rd.Hig;
   \                     ??comm_para_flow_4: (+1)
   \   000000E6   0x.... 0x....      LDR.W    R0,??DataTable2
   \   000000EA   0xF8B0 0x00A2      LDRH     R0,[R0, #+162]
   \   000000EE   0x8821             LDRH     R1,[R4, #+0]
   \   000000F0   0x1808             ADDS     R0,R1,R0
   \   000000F2   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000000F6   0xF8A1 0x00A2      STRH     R0,[R1, #+162]
    185                  if(sCtrl.SOilPara.Hig  > 500)
   \   000000FA   0x.... 0x....      LDR.W    R0,??DataTable2
   \   000000FE   0xF9B0 0x00A2      LDRSH    R0,[R0, #+162]
   \   00000102   0xF5B0 0x7FFA      CMP      R0,#+500
   \   00000106   0xDD05             BLE.N    ??comm_para_flow_18
    186                      sCtrl.SOilPara.Hig = 500;
   \   00000108   0xF44F 0x70FA      MOV      R0,#+500
   \   0000010C   0x.... 0x....      LDR.W    R1,??DataTable2
   \   00000110   0xF8A1 0x00A2      STRH     R0,[R1, #+162]
    187                  
    188                  if(sCtrl.SOilPara.Hig  < -500)
   \                     ??comm_para_flow_18: (+1)
   \   00000114   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000118   0xF9B0 0x00A2      LDRSH    R0,[R0, #+162]
   \   0000011C   0xF510 0x7FFA      CMN      R0,#+500
   \   00000120   0xDA05             BGE.N    ??comm_para_flow_19
    189                      sCtrl.SOilPara.Hig = -500;
   \   00000122   0x.... 0x....      LDR.W    R0,??DataTable2_3  ;; 0xfffffe0c
   \   00000126   0x.... 0x....      LDR.W    R1,??DataTable2
   \   0000012A   0xF8A1 0x00A2      STRH     R0,[R1, #+162]
    190                  
    191                  FRAM_StoreOilPara((StrOilPara *)&sCtrl.SOilPara);   //存数据。关键数据存储时保护
   \                     ??comm_para_flow_19: (+1)
   \   0000012E   0x.... 0x....      LDR.W    R0,??DataTable2_1
   \   00000132   0x.... 0x....      BL       FRAM_StoreOilPara
    192                  
    193                  uprintf("%8d",sCtrl.SOilPara.Hig);     
   \   00000136   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000013A   0xF9B0 0x10A2      LDRSH    R1,[R0, #+162]
   \   0000013E   0xA093             ADR.N    R0,??comm_para_flow_15  ;; "%8d"
   \   00000140   0x.... 0x....      BL       uprintf
    194                  
    195                  break;
   \   00000144   0xE1D2             B.N      ??comm_para_flow_16
    196                  
    197                  //模型选择卡
    198              case    MODEL_SELECT_CARD:   
    199                  sCtrl.SOilPara.ModelNum = sDtu->Rd.ModelNum;//选择的模型编号
   \                     ??comm_para_flow_5: (+1)
   \   00000146   0x7820             LDRB     R0,[R4, #+0]
   \   00000148   0x.... 0x....      LDR.W    R1,??DataTable2
   \   0000014C   0xF881 0x00A0      STRB     R0,[R1, #+160]
    200                  
    201                  FRAM_StoreOilPara((StrOilPara *)&sCtrl.SOilPara);   //存数据。关键数据存储时保护
   \   00000150   0x.... 0x....      LDR.W    R0,??DataTable2_1
   \   00000154   0x.... 0x....      BL       FRAM_StoreOilPara
    202                  
    203                  uprintf("%8d",sCtrl.SOilPara.ModelNum);      //立即显示设定值 
   \   00000158   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000015C   0xF890 0x10A0      LDRB     R1,[R0, #+160]
   \   00000160   0xA08A             ADR.N    R0,??comm_para_flow_15  ;; "%8d"
   \   00000162   0x.... 0x....      BL       uprintf
    204                  break;
   \   00000166   0xE1C1             B.N      ??comm_para_flow_16
    205                  
    206                  //车型车号
    207              case    FIX_CARD: 
    208                  sCtrl.sProductInfo.sLocoId.Num = sDtu->Rd.sLocoId.Num;
   \                     ??comm_para_flow_6: (+1)
   \   00000168   0x8860             LDRH     R0,[R4, #+2]
   \   0000016A   0x.... 0x....      LDR.W    R1,??DataTable2
   \   0000016E   0x83C8             STRH     R0,[R1, #+30]
    209                  sCtrl.sProductInfo.sLocoId.Type = sDtu->Rd.sLocoId.Type;
   \   00000170   0x8820             LDRH     R0,[R4, #+0]
   \   00000172   0x.... 0x....      LDR.W    R1,??DataTable2
   \   00000176   0x8388             STRH     R0,[R1, #+28]
    210                  
    211                  FRAM_StoreProductInfo((StrProductInfo *)&sCtrl.sProductInfo);
   \   00000178   0x.... 0x....      LDR.W    R0,??DataTable2_4
   \   0000017C   0x.... 0x....      BL       FRAM_StoreProductInfo
    212                  
    213                  uprintf("%4d.%4d"   ,sCtrl.sProductInfo.sLocoId.Type
    214                          ,sCtrl.sProductInfo.sLocoId.Num
    215                              );      
   \   00000180   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000184   0x8BC2             LDRH     R2,[R0, #+30]
   \   00000186   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000018A   0x8B81             LDRH     R1,[R0, #+28]
   \   0000018C   0x.... 0x....      LDR.W    R0,??DataTable2_5
   \   00000190   0x.... 0x....      BL       uprintf
    216                  break;
   \   00000194   0xE1AA             B.N      ??comm_para_flow_16
    217                  
    218                  //读数据指示
    219              case    DATA_CARD_DIS: 
    220                  i=0;
   \                     ??comm_para_flow_7: (+1)
   \   00000196   0x2000             MOVS     R0,#+0
   \   00000198   0x0007             MOVS     R7,R0
    221                  while(i < 4)
   \                     ??comm_para_flow_20: (+1)
   \   0000019A   0xB2FF             UXTB     R7,R7            ;; ZeroExt  R7,R7,#+24,#+24
   \   0000019C   0x2F04             CMP      R7,#+4
   \   0000019E   0xDA06             BGE.N    ??comm_para_flow_21
    222                  {
    223                      uprintf("%8d",i); 
   \   000001A0   0xB2FF             UXTB     R7,R7            ;; ZeroExt  R7,R7,#+24,#+24
   \   000001A2   0x0039             MOVS     R1,R7
   \   000001A4   0xA079             ADR.N    R0,??comm_para_flow_15  ;; "%8d"
   \   000001A6   0x.... 0x....      BL       uprintf
    224                      i++;
   \   000001AA   0x1C7F             ADDS     R7,R7,#+1
   \   000001AC   0xE7F5             B.N      ??comm_para_flow_20
    225                  }
    226                  break;
   \                     ??comm_para_flow_21: (+1)
   \   000001AE   0xE19D             B.N      ??comm_para_flow_16
    227                  
    228                  //读数据指示结束
    229              case    DATA_CARD_FIN: 
    230                  i=0;
   \                     ??comm_para_flow_8: (+1)
   \   000001B0   0x2000             MOVS     R0,#+0
   \   000001B2   0x0007             MOVS     R7,R0
    231                  while(i < 4)
   \                     ??comm_para_flow_22: (+1)
   \   000001B4   0xB2FF             UXTB     R7,R7            ;; ZeroExt  R7,R7,#+24,#+24
   \   000001B6   0x2F04             CMP      R7,#+4
   \   000001B8   0xDA09             BGE.N    ??comm_para_flow_23
    232                  {
    233                      uprintf("    good");  
   \   000001BA   0x.... 0x....      LDR.W    R0,??DataTable2_6
   \   000001BE   0x.... 0x....      BL       uprintf
    234                      uprintf("         ");  
   \   000001C2   0x.... 0x....      LDR.W    R0,??DataTable2_7
   \   000001C6   0x.... 0x....      BL       uprintf
    235                      i++;
   \   000001CA   0x1C7F             ADDS     R7,R7,#+1
   \   000001CC   0xE7F2             B.N      ??comm_para_flow_22
    236                  }
    237                  break;
   \                     ??comm_para_flow_23: (+1)
   \   000001CE   0xE18D             B.N      ??comm_para_flow_16
    238                  
    239                  //数据清零
    240              case    CLEAR_ALL: 
    241                  sCtrl.sRecNumMgr.Current = 0;
   \                     ??comm_para_flow_10: (+1)
   \   000001D0   0x2000             MOVS     R0,#+0
   \   000001D2   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000001D6   0x6048             STR      R0,[R1, #+4]
    242                  sCtrl.sRecNumMgr.GrsRead = 0;
   \   000001D8   0x2000             MOVS     R0,#+0
   \   000001DA   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000001DE   0x60C8             STR      R0,[R1, #+12]
    243                  sCtrl.sRecNumMgr.IcRead  = 0;
   \   000001E0   0x2000             MOVS     R0,#+0
   \   000001E2   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000001E6   0x6088             STR      R0,[R1, #+8]
    244                  
    245                  FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr);
   \   000001E8   0x.... 0x....      LDR.W    R0,??DataTable2_8
   \   000001EC   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    246                  
    247                  uprintf("    CALL");  
   \   000001F0   0x.... 0x....      LDR.W    R0,??DataTable2_9
   \   000001F4   0x.... 0x....      BL       uprintf
    248                  
    249                  break;
   \   000001F8   0xE178             B.N      ??comm_para_flow_16
    250                  
    251                  //装置复位，先应答消息，再
    252              case    RST_SYS:
    253                  
    254                  //参数设置，数据原路返回
    255                  CSNC_SendData(  sCtrl.Dtu.pch,                      //DTU 的PCH：串口号，收发控制等底层信息
    256                                  sCtrl.Dtu.RxCtrl.DestAddr,          //源地址，
    257                                  sCtrl.Dtu.RxCtrl.SourceAddr,        //目标地址
    258                                  sCtrl.Dtu.RxCtrl.FramNum,           //帧序号 
    259                                  sCtrl.Dtu.RxCtrl.FrameCode,         //命令字
    260                                  sCtrl.Dtu.Rd.Buf,                   //数据区
    261                                  sCtrl.Dtu.RxCtrl.Len                //发送长度
    262                                );
   \                     ??comm_para_flow_11: (+1)
   \   000001FA   0x.... 0x....      LDR.W    R0,??DataTable2
   \   000001FE   0xF890 0x04F0      LDRB     R0,[R0, #+1264]
   \   00000202   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000204   0x9002             STR      R0,[SP, #+8]
   \   00000206   0x.... 0x....      LDR.W    R0,??DataTable2_10
   \   0000020A   0x9001             STR      R0,[SP, #+4]
   \   0000020C   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000210   0xF890 0x04F1      LDRB     R0,[R0, #+1265]
   \   00000214   0x9000             STR      R0,[SP, #+0]
   \   00000216   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000021A   0xF890 0x34EF      LDRB     R3,[R0, #+1263]
   \   0000021E   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000222   0xF890 0x24EE      LDRB     R2,[R0, #+1262]
   \   00000226   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000022A   0xF890 0x14ED      LDRB     R1,[R0, #+1261]
   \   0000022E   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000232   0xF8D0 0x0509      LDR      R0,[R0, #+1289]
   \   00000236   0x.... 0x....      BL       CSNC_SendData
    263                  i = 100000;
   \   0000023A   0x20A0             MOVS     R0,#+160
   \   0000023C   0x0007             MOVS     R7,R0
    264                  while(i--);
   \                     ??comm_para_flow_24: (+1)
   \   0000023E   0x0038             MOVS     R0,R7
   \   00000240   0x1E47             SUBS     R7,R0,#+1
   \   00000242   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   00000244   0x2800             CMP      R0,#+0
   \   00000246   0xD1FA             BNE.N    ??comm_para_flow_24
    265                  
    266                  Restart();                                          //重启系统
   \   00000248   0x.... 0x....      BL       Restart
    267                  break;
   \   0000024C   0xE14E             B.N      ??comm_para_flow_16
    268                  
    269                  //设置斜率
    270              case    CALC_PARA: 
    271                  //斜率具有镭计的效果
    272                  sCtrl.SOilPara.Slope = (sCtrl.SOilPara.Slope  * sDtu->Rd.Slope)/10000;
   \                     ??comm_para_flow_12: (+1)
   \   0000024E   0x.... 0x....      LDR.W    R0,??DataTable2
   \   00000252   0xF8D0 0x00A8      LDR      R0,[R0, #+168]
   \   00000256   0x6821             LDR      R1,[R4, #+0]
   \   00000258   0x4348             MULS     R0,R1,R0
   \   0000025A   0xF242 0x7110      MOVW     R1,#+10000
   \   0000025E   0xFBB0 0xF0F1      UDIV     R0,R0,R1
   \   00000262   0x.... 0x....      LDR.W    R1,??DataTable2
   \   00000266   0xF8C1 0x00A8      STR      R0,[R1, #+168]
    273                  
    274                  //0.1~2
    275                  if(sCtrl.SOilPara.Slope >20000 || sCtrl.SOilPara.Slope < 1000)
   \   0000026A   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000026E   0xF8D0 0x00A8      LDR      R0,[R0, #+168]
   \   00000272   0xF644 0x6121      MOVW     R1,#+20001
   \   00000276   0x4288             CMP      R0,R1
   \   00000278   0xD206             BCS.N    ??comm_para_flow_25
   \   0000027A   0x.... 0x....      LDR.W    R0,??DataTable2
   \   0000027E   0xF8D0 0x00A8      LDR      R0,[R0, #+168]
   \   00000282   0xF5B0 0x7F7A      CMP      R0,#+1000
   \   00000286   0xD205             BCS.N    ??comm_para_flow_26
    276                      sCtrl.SOilPara.Slope = 10000;
   \                     ??comm_para_flow_25: (+1)
   \   00000288   0xF242 0x7010      MOVW     R0,#+10000
   \   0000028C   0x.... 0x....      LDR.W    R1,??DataTable2
   \   00000290   0xF8C1 0x00A8      STR      R0,[R1, #+168]
    277                  
    278                  FRAM_StoreOilPara((StrOilPara *)&sCtrl.SOilPara);   //存数据。关键数据存储时保护
   \                     ??comm_para_flow_26: (+1)
   \   00000294   0x.... 0x....      LDR.W    R0,??DataTable2_1
   \   00000298   0x.... 0x....      BL       FRAM_StoreOilPara
    279                  
    280                  uprintf("%d",sCtrl.SOilPara.Slope);         //立即显示设定值 
   \   0000029C   0x.... 0x....      LDR.W    R0,??DataTable2
   \   000002A0   0xF8D0 0x10A8      LDR      R1,[R0, #+168]
   \   000002A4   0x....             ADR.N    R0,??DataTable0  ;; 0x25, 0x64, 0x00, 0x00
   \   000002A6   0x.... 0x....      BL       uprintf
    281                  break;
   \   000002AA   0xE11F             B.N      ??comm_para_flow_16
    282                  
    283                  /***********************************************
    284                  * 描述： 设置油箱模型。
    285                  *   IC 卡模块插入IC卡后，IC卡主动应答模型。  
    286                  *   后续每200ms发送数据，序号从0开始累加。
    287                  数据发送完成后，序号为0xffffffff。
    288                  */    
    289                  //设置斜率
    290              case    SYS_RUN_PARA: 
    291                  //存运行参数，存储时间，数据格式等信息
    292                  //FRAM_StoreRunPara((stcRunPara *)&sCtrl.sRunPara);   //存数据。关键数据存储时保护
    293                  uint8  bittmp =  0x01 << ( ( (uint8 *)&sCtrl.sRunPara.StoreType ) - (uint8 *)&sCtrl.sRunPara);    //数据格式更改
   \                     ??comm_para_flow_9: (+1)
   \   000002AC   0xF05F 0x0820      MOVS     R8,#+32
    294                  
    295                  if((sDtu->Rd.sRunPara.SetBitFlg & bittmp) == bittmp )
   \   000002B0   0x79E0             LDRB     R0,[R4, #+7]
   \   000002B2   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   000002B6   0xEA18 0x0000      ANDS     R0,R8,R0
   \   000002BA   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   000002BE   0x4540             CMP      R0,R8
   \   000002C0   0xD109             BNE.N    ??comm_para_flow_27
    296                  {
    297                      sCtrl.sRunPara.StoreType    = sDtu->Rd.sRunPara.StoreType;
   \   000002C2   0x7960             LDRB     R0,[R4, #+5]
   \   000002C4   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000002C8   0xF881 0x00B1      STRB     R0,[R1, #+177]
    298                      sCtrl.sRunPara.StoreTypeBak = sDtu->Rd.sRunPara.StoreTypeBak;
   \   000002CC   0x79A0             LDRB     R0,[R4, #+6]
   \   000002CE   0x.... 0x....      LDR.W    R1,??DataTable2
   \   000002D2   0xF881 0x00B2      STRB     R0,[R1, #+178]
    299                  }
    300                
    301                  FRAM_StoreRunPara((stcRunPara *)&sCtrl.sRunPara);   //存数据。关键数据存储时保护
   \                     ??comm_para_flow_27: (+1)
   \   000002D6   0x.... 0x....      LDR.W    R0,??DataTable2_11
   \   000002DA   0x.... 0x....      BL       FRAM_StoreRunPara
    302                  uprintf("rt-%d",    sCtrl.sRunPara.StoreType);      //立即显示设定值 （0x02 ）数据新版
   \   000002DE   0x.... 0x....      LDR.W    R0,??DataTable2
   \   000002E2   0xF890 0x10B1      LDRB     R1,[R0, #+177]
   \   000002E6   0x.... 0x....      LDR.W    R0,??DataTable2_12
   \   000002EA   0x.... 0x....      BL       uprintf
    303          
    304                  break;
   \   000002EE   0xE0FD             B.N      ??comm_para_flow_16
    305                  
    306              case    MODEL_CARD: 
    307                  //模型数据接收序号
    308                  memcpy((uint8  *)&modelrecvnum,(uint8 *)&sDtu->Rd.Buf[0],sizeof(modelrecvnum));
   \                     ??comm_para_flow_2: (+1)
   \   000002F0   0xF05F 0x0904      MOVS     R9,#+4
   \   000002F4   0xF10D 0x0A14      ADD      R10,SP,#+20
   \   000002F8   0x464A             MOV      R2,R9
   \   000002FA   0x0021             MOVS     R1,R4
   \   000002FC   0x4650             MOV      R0,R10
   \   000002FE   0x.... 0x....      BL       __aeabi_memcpy
    309                  
    310                  if( modelrecvnum == 0 )                 //开始    
   \   00000302   0x9805             LDR      R0,[SP, #+20]
   \   00000304   0x2800             CMP      R0,#+0
   \   00000306   0xD103             BNE.N    ??comm_para_flow_28
    311                      modelstoreaddr = 0;
   \   00000308   0x2000             MOVS     R0,#+0
   \   0000030A   0x.... 0x....      LDR.W    R1,??DataTable2_13
   \   0000030E   0x6008             STR      R0,[R1, #+0]
    312                  
    313                  if(sDtu->RxCtrl.Len < sizeof(modelrecvnum))
   \                     ??comm_para_flow_28: (+1)
   \   00000310   0xF894 0x0143      LDRB     R0,[R4, #+323]
   \   00000314   0x2804             CMP      R0,#+4
   \   00000316   0xF0C0 0x80E9      BCC.W    ??comm_para_flow_16
    314                      break;
    315                  //保存接收到的数据
    316                  WriteFM24CL64(   OIL_BOX_MODEL_ADDR+modelstoreaddr,
    317                                (uint8 *)&sDtu->Rd.Buf[sizeof(modelrecvnum)], 
    318                                sDtu->RxCtrl.Len - sizeof(modelrecvnum));
   \                     ??comm_para_flow_29: (+1)
   \   0000031A   0xF894 0x0143      LDRB     R0,[R4, #+323]
   \   0000031E   0x1F02             SUBS     R2,R0,#+4
   \   00000320   0x1D21             ADDS     R1,R4,#+4
   \   00000322   0x.... 0x....      LDR.W    R0,??DataTable2_13
   \   00000326   0x6800             LDR      R0,[R0, #+0]
   \   00000328   0xF510 0x60FA      ADDS     R0,R0,#+2000
   \   0000032C   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   0000032E   0x.... 0x....      BL       WriteFM24CL64
    319                  //存地址累加
    320                  modelstoreaddr += (sDtu->RxCtrl.Len - sizeof(modelrecvnum));
   \   00000332   0x.... 0x....      LDR.W    R0,??DataTable2_13
   \   00000336   0x6800             LDR      R0,[R0, #+0]
   \   00000338   0xF894 0x1143      LDRB     R1,[R4, #+323]
   \   0000033C   0x1F09             SUBS     R1,R1,#+4
   \   0000033E   0x1808             ADDS     R0,R1,R0
   \   00000340   0x.... 0x....      LDR.W    R1,??DataTable2_13
   \   00000344   0x6008             STR      R0,[R1, #+0]
    321                  
    322                  //指示操作
    323                  //uprintf("   ...");
    324                  if(modelrecvnum == 0xffffffff)  //结束，指示
   \   00000346   0x9805             LDR      R0,[SP, #+20]
   \   00000348   0xF110 0x0F01      CMN      R0,#+1
   \   0000034C   0xD116             BNE.N    ??comm_para_flow_30
    325                  {
    326                      uprintf("");
   \   0000034E   0x....             ADR.N    R0,??DataTable1  ;; ""
   \   00000350   0x.... 0x....      BL       uprintf
    327                      uprintf("boX");	
   \   00000354   0x....             ADR.N    R0,??DataTable1_1  ;; "boX"
   \   00000356   0x.... 0x....      BL       uprintf
    328                      uprintf("boX");		
   \   0000035A   0x....             ADR.N    R0,??DataTable1_1  ;; "boX"
   \   0000035C   0x.... 0x....      BL       uprintf
    329                      GetOilPara();
   \   00000360   0x.... 0x....      BL       GetOilPara
    330                      
    331                      //与单独设置油量模型兼容，写卡成功后，应将单设模型置为无效,并保存。，再重新调用初始化函数
    332                      l_sCalcModel.valid = 0;
   \   00000364   0x2000             MOVS     R0,#+0
   \   00000366   0x.... 0x....      LDR.W    R1,??DataTable2_14
   \   0000036A   0xF881 0x0195      STRB     R0,[R1, #+405]
    333                      FRAM_StoreCalcModel(&sCtrl.sCalcModel);             //数据油量存储
   \   0000036E   0x.... 0x....      LDR.W    R0,??DataTable2_15
   \   00000372   0x.... 0x....      BL       FRAM_StoreCalcModel
    334                      
    335                      GetOilPara();                                       //重新取计算参数
   \   00000376   0x.... 0x....      BL       GetOilPara
   \   0000037A   0xE004             B.N      ??comm_para_flow_31
    336                  }else{
    337                      uprintf("o..%2d",modelrecvnum);
   \                     ??comm_para_flow_30: (+1)
   \   0000037C   0x9905             LDR      R1,[SP, #+20]
   \   0000037E   0x.... 0x....      LDR.W    R0,??DataTable2_16
   \   00000382   0x.... 0x....      BL       uprintf
    338                  }
    339                  
    340                  SetDispNow();               //马上显示
   \                     ??comm_para_flow_31: (+1)
   \   00000386   0x.... 0x....      BL       SetDispNow
    341                  
    342                  
    343          //        if(sDtu->pch->PortNbr == 2)
    344          //        {
    345          //            osal_start_timerEx( OS_TASK_ID_TMR, 
    346          //                               OS_EVT_TMR_OTR, 
    347          //                               OS_TICKS_PER_SEC*10 );          //统计装置和无线发送模块定时器  10s
    348          //        }
    349          //        
    350          //        if(sDtu->pch->PortNbr == 3)
    351          //        {
    352          //            osal_start_timerEx( OS_TASK_ID_TMR, 
    353          //                               OS_EVT_TMR_DTU, 
    354          //                               OS_TICKS_PER_SEC*10 );          //统计装置和无线发送模块定时器  10s
    355          //        }
    356                  break;
   \   0000038A   0xE0AF             B.N      ??comm_para_flow_16
   \                     ??comm_para_flow_15:
   \   0000038C   0x25 0x38          DC8      "%8d"
   \              0x64 0x00    
    357                  
    358                  //数据
    359              case    DATA_CARD: 
    360                  
    361                  memcpy((uint8 *)&tmp32,sDtu->Rd.Buf,sizeof(tmp32));     //请求流水号
   \                     ??comm_para_flow_0: (+1)
   \   00000390   0xF05F 0x0904      MOVS     R9,#+4
   \   00000394   0xF10D 0x0A0C      ADD      R10,SP,#+12
   \   00000398   0x464A             MOV      R2,R9
   \   0000039A   0x0021             MOVS     R1,R4
   \   0000039C   0x4650             MOV      R0,R10
   \   0000039E   0x.... 0x....      BL       __aeabi_memcpy
    362                  if(sDtu->RxCtrl.SourceAddr == SLAVE_ADDR_DTU)           //无线通道请求的
   \   000003A2   0xF894 0x0141      LDRB     R0,[R4, #+321]
   \   000003A6   0x28CA             CMP      R0,#+202
   \   000003A8   0xD115             BNE.N    ??comm_para_flow_32
    363                  {
    364                      if(sCtrl.sRecNumMgr.GrsRead  > tmp32){
   \   000003AA   0x9803             LDR      R0,[SP, #+12]
   \   000003AC   0x....             LDR.N    R1,??DataTable2
   \   000003AE   0x68C9             LDR      R1,[R1, #+12]
   \   000003B0   0x4288             CMP      R0,R1
   \   000003B2   0xD202             BCS.N    ??comm_para_flow_33
    365                          sCtrl.sRecNumMgr.GrsRead = tmp32;               //指定位置取数据
   \   000003B4   0x9803             LDR      R0,[SP, #+12]
   \   000003B6   0x....             LDR.N    R1,??DataTable2
   \   000003B8   0x60C8             STR      R0,[R1, #+12]
    366                      }
    367                      
    368                      comm_record_send_one(sDtu,addrnum);                 
   \                     ??comm_para_flow_33: (+1)
   \   000003BA   0x0029             MOVS     R1,R5
   \   000003BC   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   000003BE   0x0020             MOVS     R0,R4
   \   000003C0   0x.... 0x....      BL       comm_record_send_one
    369                      
    370                      FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr);         //保存记录号
   \   000003C4   0x....             LDR.N    R0,??DataTable2_8
   \   000003C6   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    371                      
    372                      sCtrl.sRecNumMgr.GrsRead++;
   \   000003CA   0x....             LDR.N    R0,??DataTable2
   \   000003CC   0x68C0             LDR      R0,[R0, #+12]
   \   000003CE   0x1C40             ADDS     R0,R0,#+1
   \   000003D0   0x....             LDR.N    R1,??DataTable2
   \   000003D2   0x60C8             STR      R0,[R1, #+12]
   \   000003D4   0xE024             B.N      ??comm_para_flow_34
    373                      
    374                  }else if(sDtu->RxCtrl.SourceAddr == SLAVE_ADDR_OTR)     //IC卡
   \                     ??comm_para_flow_32: (+1)
   \   000003D6   0xF894 0x0141      LDRB     R0,[R4, #+321]
   \   000003DA   0x28C1             CMP      R0,#+193
   \   000003DC   0xD120             BNE.N    ??comm_para_flow_34
    375                  {
    376                      if(sCtrl.sRecNumMgr.IcRead  > tmp32){
   \   000003DE   0x9803             LDR      R0,[SP, #+12]
   \   000003E0   0x....             LDR.N    R1,??DataTable2
   \   000003E2   0x6889             LDR      R1,[R1, #+8]
   \   000003E4   0x4288             CMP      R0,R1
   \   000003E6   0xD202             BCS.N    ??comm_para_flow_35
    377                          sCtrl.sRecNumMgr.IcRead = tmp32;                //指定位置取数据
   \   000003E8   0x9803             LDR      R0,[SP, #+12]
   \   000003EA   0x....             LDR.N    R1,??DataTable2
   \   000003EC   0x6088             STR      R0,[R1, #+8]
    378                      }
    379                      
    380                      comm_record_send_one(sDtu,addrnum);                 //指定位置取数据   
   \                     ??comm_para_flow_35: (+1)
   \   000003EE   0x0029             MOVS     R1,R5
   \   000003F0   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   000003F2   0x0020             MOVS     R0,R4
   \   000003F4   0x.... 0x....      BL       comm_record_send_one
    381                      
    382                      FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr); //保存记录号
   \   000003F8   0x....             LDR.N    R0,??DataTable2_8
   \   000003FA   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    383                      
    384                      sCtrl.sRecNumMgr.IcRead++;           
   \   000003FE   0x....             LDR.N    R0,??DataTable2
   \   00000400   0x6880             LDR      R0,[R0, #+8]
   \   00000402   0x1C40             ADDS     R0,R0,#+1
   \   00000404   0x....             LDR.N    R1,??DataTable2
   \   00000406   0x6088             STR      R0,[R1, #+8]
    385                      
    386                      //快速启动定时器
    387                      if(sCtrl.sRecNumMgr.IcRead < sCtrl.sRecNumMgr.Current ){
   \   00000408   0x....             LDR.N    R0,??DataTable2
   \   0000040A   0x6880             LDR      R0,[R0, #+8]
   \   0000040C   0x....             LDR.N    R1,??DataTable2
   \   0000040E   0x6849             LDR      R1,[R1, #+4]
   \   00000410   0x4288             CMP      R0,R1
   \   00000412   0xD205             BCS.N    ??comm_para_flow_34
    388                          osal_start_timerRl( OS_TASK_ID_TMR, 
    389                                             OS_EVT_TMR_OTR, 
    390                                             OS_TICKS_PER_SEC/2 );          //统计装置和无线发送模块定时器  10s
   \   00000414   0xF44F 0x72FA      MOV      R2,#+500
   \   00000418   0x2108             MOVS     R1,#+8
   \   0000041A   0x2001             MOVS     R0,#+1
   \   0000041C   0x.... 0x....      BL       osal_start_timerRl
    391                      }
    392                      
    393                  }
    394                  break;
   \                     ??comm_para_flow_34: (+1)
   \   00000420   0xE064             B.N      ??comm_para_flow_16
    395                  
    396              case    RUN_MODEL_PARA:
    397                  
    398                  uprintf("SET--");         //立即显示设定值 
   \                     ??comm_para_flow_13: (+1)
   \   00000422   0x....             LDR.N    R0,??DataTable2_17
   \   00000424   0x.... 0x....      BL       uprintf
    399                  SetDispNow();
   \   00000428   0x.... 0x....      BL       SetDispNow
    400                  
    401                  memcpy((uint8 *)&tmp32, &sDtu->Rd.Buf[0],sizeof(tmp32));        //取帧序号
   \   0000042C   0xF05F 0x0904      MOVS     R9,#+4
   \   00000430   0xF10D 0x0A0C      ADD      R10,SP,#+12
   \   00000434   0x464A             MOV      R2,R9
   \   00000436   0x0021             MOVS     R1,R4
   \   00000438   0x4650             MOV      R0,R10
   \   0000043A   0x.... 0x....      BL       __aeabi_memcpy
    402                  if(tmp32 < (1 + sizeof(l_sCalcModel)/128 ))                     //序号有效
   \   0000043E   0x9803             LDR      R0,[SP, #+12]
   \   00000440   0x2804             CMP      R0,#+4
   \   00000442   0xD252             BCS.N    ??comm_para_flow_36
    403                  {
    404                      p = (uint8 *)&l_sCalcModel;
   \   00000444   0x....             LDR.N    R0,??DataTable2_14
   \   00000446   0x0006             MOVS     R6,R0
    405                      memcpy((uint8 *)(  p + 128*tmp32),
    406                                         (uint8 *)&sDtu->Rd.Buf[4],
    407                                         sDtu->RxCtrl.Len-4);
   \   00000448   0xF894 0x0143      LDRB     R0,[R4, #+323]
   \   0000044C   0xF1B0 0x0904      SUBS     R9,R0,#+4
   \   00000450   0xF114 0x0A04      ADDS     R10,R4,#+4
   \   00000454   0x9803             LDR      R0,[SP, #+12]
   \   00000456   0x2180             MOVS     R1,#+128
   \   00000458   0xFB01 0x6B00      MLA      R11,R1,R0,R6
   \   0000045C   0x464A             MOV      R2,R9
   \   0000045E   0x4651             MOV      R1,R10
   \   00000460   0x4658             MOV      R0,R11
   \   00000462   0x.... 0x....      BL       __aeabi_memcpy
    408                      
    409                      if(tmp32 == sizeof(l_sCalcModel)/128)               //接收完成
   \   00000466   0x9803             LDR      R0,[SP, #+12]
   \   00000468   0x2803             CMP      R0,#+3
   \   0000046A   0xD13E             BNE.N    ??comm_para_flow_36
    410                      {
    411                          crc16 = GetCrc16Check((uint8 *)&l_sCalcModel,sizeof(l_sCalcModel)-2);   //计算校验
   \   0000046C   0xF44F 0x71CB      MOV      R1,#+406
   \   00000470   0x....             LDR.N    R0,??DataTable2_14
   \   00000472   0x.... 0x....      BL       GetCrc16Check
   \   00000476   0xF8AD 0x0010      STRH     R0,[SP, #+16]
    412                          if(crc16 == l_sCalcModel.CrcCheck)              //模型校验通过，赋值给计算使用
   \   0000047A   0xF8BD 0x0010      LDRH     R0,[SP, #+16]
   \   0000047E   0x....             LDR.N    R1,??DataTable2_14
   \   00000480   0xF8B1 0x1196      LDRH     R1,[R1, #+406]
   \   00000484   0x4288             CMP      R0,R1
   \   00000486   0xD119             BNE.N    ??comm_para_flow_37
    413                          {
    414                              l_sCalcModel.valid = 1;                     //置模型有效位
   \   00000488   0x2001             MOVS     R0,#+1
   \   0000048A   0x....             LDR.N    R1,??DataTable2_14
   \   0000048C   0xF881 0x0195      STRB     R0,[R1, #+405]
    415                              
    416                              l_sCalcModel.CrcCheck = GetCrc16Check((uint8 *)&l_sCalcModel,sizeof(l_sCalcModel)-2); 
   \   00000490   0xF44F 0x71CB      MOV      R1,#+406
   \   00000494   0x....             LDR.N    R0,??DataTable2_14
   \   00000496   0x.... 0x....      BL       GetCrc16Check
   \   0000049A   0x....             LDR.N    R1,??DataTable2_14
   \   0000049C   0xF8A1 0x0196      STRH     R0,[R1, #+406]
    417                              
    418                              memcpy((uint8 *)&sCtrl.sCalcModel,(uint8 *)&l_sCalcModel,sizeof(l_sCalcModel)); //赋值给正在使用的模型。
   \   000004A0   0xF44F 0x79CC      MOV      R9,#+408
   \   000004A4   0x.... 0x....      LDR.W    R10,??DataTable2_14
   \   000004A8   0x.... 0x....      LDR.W    R11,??DataTable2_15
   \   000004AC   0x464A             MOV      R2,R9
   \   000004AE   0x4651             MOV      R1,R10
   \   000004B0   0x4658             MOV      R0,R11
   \   000004B2   0x.... 0x....      BL       __aeabi_memcpy
    419                              
    420                              FRAM_StoreCalcModel(&sCtrl.sCalcModel);
   \   000004B6   0x....             LDR.N    R0,??DataTable2_15
   \   000004B8   0x.... 0x....      BL       FRAM_StoreCalcModel
    421                          }
    422                          
    423                          //设置成功后，指示
    424                          uprintf("SET-%d",l_sCalcModel.ModelNum);         //立即显示设定值 
   \                     ??comm_para_flow_37: (+1)
   \   000004BC   0x....             LDR.N    R0,??DataTable2_14
   \   000004BE   0xF890 0x1194      LDRB     R1,[R0, #+404]
   \   000004C2   0x....             LDR.N    R0,??DataTable2_18
   \   000004C4   0x.... 0x....      BL       uprintf
    425                          SetDispNow();
   \   000004C8   0x.... 0x....      BL       SetDispNow
    426                          tmp32 = 1000000;
   \   000004CC   0x....             LDR.N    R0,??DataTable2_19  ;; 0xf4240
   \   000004CE   0x9003             STR      R0,[SP, #+12]
    427                          while(tmp32--);
   \                     ??comm_para_flow_38: (+1)
   \   000004D0   0x9803             LDR      R0,[SP, #+12]
   \   000004D2   0x1E41             SUBS     R1,R0,#+1
   \   000004D4   0x9103             STR      R1,[SP, #+12]
   \   000004D6   0x2800             CMP      R0,#+0
   \   000004D8   0xD1FA             BNE.N    ??comm_para_flow_38
    428                          uprintf("SET-%d",l_sCalcModel.ModelNum);         //立即显示设定值 
   \   000004DA   0x....             LDR.N    R0,??DataTable2_14
   \   000004DC   0xF890 0x1194      LDRB     R1,[R0, #+404]
   \   000004E0   0x....             LDR.N    R0,??DataTable2_18
   \   000004E2   0x.... 0x....      BL       uprintf
    429                          SetDispNow();
   \   000004E6   0x.... 0x....      BL       SetDispNow
    430                      }
    431                  }
    432                  
    433                  break;
   \                     ??comm_para_flow_36: (+1)
   \   000004EA   0xE7FF             B.N      ??comm_para_flow_16
    434                  
    435              default:
    436                  break;
    437          
    438              }
    439          }
   \                     ??comm_para_flow_14: (+1)
   \                     ??comm_para_flow_16: (+1)
   \   000004EC   0xB009             ADD      SP,SP,#+36
   \   000004EE   0xE8BD 0x8FF0      POP      {R4-R11,PC}      ;; return

   \                                 In section .bss, align 4
   \                     ??modelstoreaddr:
   \   00000000                      DS8 4
    440          
    441          /*******************************************************************************
    442          * 名    称： comm_record_send_one
    443          * 功    能： 发送one条数据记录
    444          * 入口参数： 无线设备数据结构
    445          * 出口参数： 无
    446          * 作　 　者： redmorningcn.
    447          * 创建日期： 2017-05-19
    448          * 修    改：
    449          * 修改日期：
    450          * 备    注： 任务创建函数需要在app.h文件中声明
    451          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    452          uint8    comm_record_send_one(StrDevDtu * sDtu,uint8    addrnum)
    453          {
   \                     comm_record_send_one: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0xB084             SUB      SP,SP,#+16
   \   00000004   0x0004             MOVS     R4,R0
   \   00000006   0x000D             MOVS     R5,R1
    454              
    455              //记录号为0，还未发送数据。不做通讯状态判断
    456              if( sCtrl.sRecNumMgr.Current == 0 )                                   
   \   00000008   0x....             LDR.N    R0,??DataTable2
   \   0000000A   0x6840             LDR      R0,[R0, #+4]
   \   0000000C   0x2800             CMP      R0,#+0
   \   0000000E   0xD101             BNE.N    ??comm_record_send_one_0
    457              {
    458                  return 0;
   \   00000010   0x2000             MOVS     R0,#+0
   \   00000012   0xE085             B.N      ??comm_record_send_one_1
    459              }
    460              /***********************************************
    461              * 描述： 记录号合理性判断。已发数据<当前数据 发送数据
    462              * 
    463              */ 
    464              if(sDtu->ConnCtrl[addrnum].SlaveAddr == SLAVE_ADDR_DTU)
   \                     ??comm_record_send_one_0: (+1)
   \   00000014   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000016   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   0000001A   0xF890 0x0150      LDRB     R0,[R0, #+336]
   \   0000001E   0x28CA             CMP      R0,#+202
   \   00000020   0xD120             BNE.N    ??comm_record_send_one_2
    465              {
    466                  if(sCtrl.sRecNumMgr.Current <= sCtrl.sRecNumMgr.GrsRead )               //已发送记录号比当前记录号大，进行异常处理
   \   00000022   0x....             LDR.N    R0,??DataTable2
   \   00000024   0x68C0             LDR      R0,[R0, #+12]
   \   00000026   0x....             LDR.N    R1,??DataTable2
   \   00000028   0x6849             LDR      R1,[R1, #+4]
   \   0000002A   0x4288             CMP      R0,R1
   \   0000002C   0xD30E             BCC.N    ??comm_record_send_one_3
    467                  {
    468                      sCtrl.sRecNumMgr.GrsRead = 0;
   \   0000002E   0x2000             MOVS     R0,#+0
   \   00000030   0x....             LDR.N    R1,??DataTable2
   \   00000032   0x60C8             STR      R0,[R1, #+12]
    469                      if(sCtrl.sRecNumMgr.Current)
   \   00000034   0x....             LDR.N    R0,??DataTable2
   \   00000036   0x6840             LDR      R0,[R0, #+4]
   \   00000038   0x2800             CMP      R0,#+0
   \   0000003A   0xD004             BEQ.N    ??comm_record_send_one_4
    470                          sCtrl.sRecNumMgr.GrsRead = sCtrl.sRecNumMgr.Current - 1;        //最后有效记录赋值     
   \   0000003C   0x....             LDR.N    R0,??DataTable2
   \   0000003E   0x6840             LDR      R0,[R0, #+4]
   \   00000040   0x1E40             SUBS     R0,R0,#+1
   \   00000042   0x....             LDR.N    R1,??DataTable2
   \   00000044   0x60C8             STR      R0,[R1, #+12]
    471                      
    472                      FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr);             //保存记录号
   \                     ??comm_record_send_one_4: (+1)
   \   00000046   0x....             LDR.N    R0,??DataTable2_8
   \   00000048   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    473                  }
    474                  
    475                  //sDtu->ConnCtrl[addrnum].SendFramNum++;                                //发送序号由接收控制
    476                  
    477                  /***********************************************
    478                  * 描述： 数据记录准备,根据记录号取数据记录。
    479                  * 
    480                  */ 
    481                  ReadFlshRec((stcFlshRec *)&sDtu->Wr.sRec,
    482                              sCtrl.sRecNumMgr.GrsRead);
   \                     ??comm_record_send_one_3: (+1)
   \   0000004C   0x....             LDR.N    R0,??DataTable2
   \   0000004E   0x68C1             LDR      R1,[R0, #+12]
   \   00000050   0xF114 0x00A0      ADDS     R0,R4,#+160
   \   00000054   0x.... 0x....      BL       ReadFlshRec
    483                  
    484                  //重新给定时器给初值。osal_start_timerRl可以自动赋值，
    485                  osal_start_timerRl( OS_TASK_ID_TMR, 
    486                                     OS_EVT_TMR_DTU, 
    487                                     OS_TICKS_PER_SEC*10 );  //统计装置和无线发送模块定时器  10s
   \   00000058   0xF242 0x7210      MOVW     R2,#+10000
   \   0000005C   0x2102             MOVS     R1,#+2
   \   0000005E   0x2001             MOVS     R0,#+1
   \   00000060   0x.... 0x....      BL       osal_start_timerRl
    488              }
    489              
    490              if(sDtu->ConnCtrl[addrnum].SlaveAddr == SLAVE_ADDR_OTR)
   \                     ??comm_record_send_one_2: (+1)
   \   00000064   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000066   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   0000006A   0xF890 0x0150      LDRB     R0,[R0, #+336]
   \   0000006E   0x28C1             CMP      R0,#+193
   \   00000070   0xD12D             BNE.N    ??comm_record_send_one_5
    491              {
    492                  if(sCtrl.sRecNumMgr.Current <= sCtrl.sRecNumMgr.IcRead )                //已发送记录号比当前记录号大，进行异常处理
   \   00000072   0x....             LDR.N    R0,??DataTable2
   \   00000074   0x6880             LDR      R0,[R0, #+8]
   \   00000076   0x....             LDR.N    R1,??DataTable2
   \   00000078   0x6849             LDR      R1,[R1, #+4]
   \   0000007A   0x4288             CMP      R0,R1
   \   0000007C   0xD31B             BCC.N    ??comm_record_send_one_6
    493                  {
    494                      sCtrl.sRecNumMgr.IcRead = 0;
   \   0000007E   0x2000             MOVS     R0,#+0
   \   00000080   0x....             LDR.N    R1,??DataTable2
   \   00000082   0x6088             STR      R0,[R1, #+8]
    495                      if(sCtrl.sRecNumMgr.Current)
   \   00000084   0x....             LDR.N    R0,??DataTable2
   \   00000086   0x6840             LDR      R0,[R0, #+4]
   \   00000088   0x2800             CMP      R0,#+0
   \   0000008A   0xD004             BEQ.N    ??comm_record_send_one_7
    496                          sCtrl.sRecNumMgr.IcRead = sCtrl.sRecNumMgr.Current - 1;         //最后有效记录赋值     
   \   0000008C   0x....             LDR.N    R0,??DataTable2
   \   0000008E   0x6840             LDR      R0,[R0, #+4]
   \   00000090   0x1E40             SUBS     R0,R0,#+1
   \   00000092   0x....             LDR.N    R1,??DataTable2
   \   00000094   0x6088             STR      R0,[R1, #+8]
    497                      
    498                      sCtrl.Otr.ConnCtrl[addrnum].SendFramNum++;
   \                     ??comm_record_send_one_7: (+1)
   \   00000096   0x....             LDR.N    R0,??DataTable2
   \   00000098   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000009A   0xEB10 0x00C5      ADDS     R0,R0,R5, LSL #+3
   \   0000009E   0xF890 0x0660      LDRB     R0,[R0, #+1632]
   \   000000A2   0x1C40             ADDS     R0,R0,#+1
   \   000000A4   0x....             LDR.N    R1,??DataTable2
   \   000000A6   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   000000A8   0xEB11 0x01C5      ADDS     R1,R1,R5, LSL #+3
   \   000000AC   0xF881 0x0660      STRB     R0,[R1, #+1632]
    499                      FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr);             //保存记录号
   \   000000B0   0x....             LDR.N    R0,??DataTable2_8
   \   000000B2   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    500                  }
    501                  
    502                  /***********************************************
    503                  * 描述： 数据记录准备,根据记录号取数据记录。
    504                  * 
    505                  */ 
    506                  ReadFlshRec((stcFlshRec *)&sDtu->Wr.sRec,
    507                              sCtrl.sRecNumMgr.IcRead);
   \                     ??comm_record_send_one_6: (+1)
   \   000000B6   0x....             LDR.N    R0,??DataTable2
   \   000000B8   0x6881             LDR      R1,[R0, #+8]
   \   000000BA   0xF114 0x00A0      ADDS     R0,R4,#+160
   \   000000BE   0x.... 0x....      BL       ReadFlshRec
    508                  
    509                  osal_start_timerRl( OS_TASK_ID_TMR, 
    510                                     OS_EVT_TMR_OTR, 
    511                                     OS_TICKS_PER_SEC*10 );               //统计装置和无线发送模块定时器  10s
   \   000000C2   0xF242 0x7210      MOVW     R2,#+10000
   \   000000C6   0x2108             MOVS     R1,#+8
   \   000000C8   0x2001             MOVS     R0,#+1
   \   000000CA   0x.... 0x....      BL       osal_start_timerRl
    512              }
    513              
    514              uint8   framecode = 0;
   \                     ??comm_record_send_one_5: (+1)
   \   000000CE   0x2600             MOVS     R6,#+0
    515              if(sCtrl.sRunPara.StoreType == 0x02 && sCtrl.sRunPara.StoreTypeBak == 0x02) //新版数据格式  redmorningcn 20170922
   \   000000D0   0x....             LDR.N    R0,??DataTable2
   \   000000D2   0xF890 0x00B1      LDRB     R0,[R0, #+177]
   \   000000D6   0x2802             CMP      R0,#+2
   \   000000D8   0xD106             BNE.N    ??comm_record_send_one_8
   \   000000DA   0x....             LDR.N    R0,??DataTable2
   \   000000DC   0xF890 0x00B2      LDRB     R0,[R0, #+178]
   \   000000E0   0x2802             CMP      R0,#+2
   \   000000E2   0xD101             BNE.N    ??comm_record_send_one_8
    516              {
    517                  framecode = 0x02;                                       //报文控制字
   \   000000E4   0x2002             MOVS     R0,#+2
   \   000000E6   0x0006             MOVS     R6,R0
    518              }
    519              //超时值发送SLAVE_ADDR_DTU 的数据
    520              CSNC_SendData(sDtu->pch,                                    //DTU 的PCH：串口号，收发控制等底层信息
    521                            sDtu->ConnCtrl[addrnum].MasterAddr,           //源地址，
    522                            sDtu->ConnCtrl[addrnum].SlaveAddr,            //目标地址
    523                            sDtu->ConnCtrl[addrnum].SendFramNum,          //帧序号 ，，在接收中累加
    524                            framecode,                                    //命令字
    525                            (uint8 *)&sDtu->Wr.sRec,                      //数据区
    526                            sizeof(sDtu->Wr.sRec)                        //发送长度
    527                                );
   \                     ??comm_record_send_one_8: (+1)
   \   000000E8   0x2080             MOVS     R0,#+128
   \   000000EA   0x9002             STR      R0,[SP, #+8]
   \   000000EC   0xF114 0x00A0      ADDS     R0,R4,#+160
   \   000000F0   0x9001             STR      R0,[SP, #+4]
   \   000000F2   0x0030             MOVS     R0,R6
   \   000000F4   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   000000F6   0x9000             STR      R0,[SP, #+0]
   \   000000F8   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   000000FA   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   000000FE   0xF890 0x3152      LDRB     R3,[R0, #+338]
   \   00000102   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000104   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   00000108   0xF890 0x2150      LDRB     R2,[R0, #+336]
   \   0000010C   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000010E   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   00000112   0xF890 0x1151      LDRB     R1,[R0, #+337]
   \   00000116   0xF8D4 0x015C      LDR      R0,[R4, #+348]
   \   0000011A   0x.... 0x....      BL       CSNC_SendData
    528          
    529              return 1;
   \   0000011E   0x2001             MOVS     R0,#+1
   \                     ??comm_record_send_one_1: (+1)
   \   00000120   0xB004             ADD      SP,SP,#+16
   \   00000122   0xBD70             POP      {R4-R6,PC}       ;; return
    530          }
    531          
    532          
    533          /*******************************************************************************
    534          * 名    称： comm_record_send
    535          * 功    能： 通讯数据传输
    536          *            先查询已发送记录，然后发送该记录。记录号加1，帧号加1。起始记录号
    537          从1开始。  
    538          *              （通过帧号判断通讯是否结束正确）
    539          * 入口参数： 无线设备数据结构
    540          * 出口参数： 无
    541          * 作　 　者： redmorningcn.
    542          * 创建日期： 2017-05-19
    543          * 修    改：
    544          * 修改日期：
    545          * 备    注： 任务创建函数需要在app.h文件中声明
    546          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    547          void    comm_record_send(StrDevDtu * sDtu,uint8 addrnum)
    548          {
   \                     comm_record_send: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0x0004             MOVS     R4,R0
   \   00000004   0x000D             MOVS     R5,R1
    549              /***********************************************
    550              * 描述： 发送和接收的记录号相符，发送流水号加1
    551              *       再根据数据量，发送数据。
    552              * 
    553              */      
    554              
    555              if(sDtu->RxCtrl.FramNum == sDtu->ConnCtrl[addrnum].SendFramNum){
   \   00000006   0xF894 0x0142      LDRB     R0,[R4, #+322]
   \   0000000A   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000000C   0xEB14 0x01C5      ADDS     R1,R4,R5, LSL #+3
   \   00000010   0xF891 0x1152      LDRB     R1,[R1, #+338]
   \   00000014   0x4288             CMP      R0,R1
   \   00000016   0xD12D             BNE.N    ??comm_record_send_0
    556                  sDtu->ConnCtrl[addrnum].SendFramNum++;                  //数据正确，序号加1
   \   00000018   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000001A   0xEB14 0x00C5      ADDS     R0,R4,R5, LSL #+3
   \   0000001E   0xF890 0x0152      LDRB     R0,[R0, #+338]
   \   00000022   0x1C40             ADDS     R0,R0,#+1
   \   00000024   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000026   0xEB14 0x01C5      ADDS     R1,R4,R5, LSL #+3
   \   0000002A   0xF881 0x0152      STRB     R0,[R1, #+338]
    557                  sCtrl.sRecNumMgr.GrsRead++;
   \   0000002E   0x....             LDR.N    R0,??DataTable2
   \   00000030   0x68C0             LDR      R0,[R0, #+12]
   \   00000032   0x1C40             ADDS     R0,R0,#+1
   \   00000034   0x....             LDR.N    R1,??DataTable2
   \   00000036   0x60C8             STR      R0,[R1, #+12]
    558                  
    559                  CPU_SR  cpu_sr;
    560                  CPU_CRITICAL_ENTER() ;
   \   00000038   0x.... 0x....      BL       CPU_SR_Save
   \   0000003C   0x0006             MOVS     R6,R0
   \   0000003E   0x.... 0x....      BL       CPU_IntDisMeasStart
    561                  FRAM_StoreRecNumMgr((StrRecNumMgr *)&sCtrl.sRecNumMgr); //保存记录号
   \   00000042   0x....             LDR.N    R0,??DataTable2_8
   \   00000044   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    562                  CPU_CRITICAL_EXIT() ;
   \   00000048   0x.... 0x....      BL       CPU_IntDisMeasStop
   \   0000004C   0x0030             MOVS     R0,R6
   \   0000004E   0x.... 0x....      BL       CPU_SR_Restore
    563                  
    564                  if(sCtrl.sRecNumMgr.GrsRead < sCtrl.sRecNumMgr.Current) //数据还未发送完成。收到数据及发送。
   \   00000052   0x....             LDR.N    R0,??DataTable2
   \   00000054   0x68C0             LDR      R0,[R0, #+12]
   \   00000056   0x....             LDR.N    R1,??DataTable2
   \   00000058   0x6849             LDR      R1,[R1, #+4]
   \   0000005A   0x4288             CMP      R0,R1
   \   0000005C   0xD20A             BCS.N    ??comm_record_send_0
    565                  {
    566                      comm_record_send_one(sDtu,addrnum);                 //发送数据记录。
   \   0000005E   0x0029             MOVS     R1,R5
   \   00000060   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   00000062   0x0020             MOVS     R0,R4
   \   00000064   0x.... 0x....      BL       comm_record_send_one
    567                      //重新启动超时定时器
    568                      osal_start_timerRl( OS_TASK_ID_TMR, 
    569                                         OS_EVT_TMR_DTU, 
    570                                         OS_TICKS_PER_SEC*10 );          //统计装置和无线发送模块定时器  10s
   \   00000068   0xF242 0x7210      MOVW     R2,#+10000
   \   0000006C   0x2102             MOVS     R1,#+2
   \   0000006E   0x2001             MOVS     R0,#+1
   \   00000070   0x.... 0x....      BL       osal_start_timerRl
    571                  }
    572                  
    573              }
    574          }
   \                     ??comm_record_send_0: (+1)
   \   00000074   0xBD70             POP      {R4-R6,PC}       ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0:
   \   00000000   0x25 0x64          DC8      0x25, 0x64, 0x00, 0x00
   \              0x00 0x00    

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable1:
   \   00000000   0x00 0x00          DC8      "",0x0,0x0,0x0
   \              0x00 0x00    

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable1_1:
   \   00000000   0x62 0x6F          DC8      "boX"
   \              0x58 0x00    

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2:
   \   00000000   0x........         DC32     sCtrl

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_1:
   \   00000000   0x........         DC32     sCtrl+0xA0

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_2:
   \   00000000   0x........         DC32     ?_1

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_3:
   \   00000000   0xFFFFFE0C         DC32     0xfffffe0c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_4:
   \   00000000   0x........         DC32     sCtrl+0x14

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_5:
   \   00000000   0x........         DC32     ?_2

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_6:
   \   00000000   0x........         DC32     ?_3

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_7:
   \   00000000   0x........         DC32     ?_4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_8:
   \   00000000   0x........         DC32     sCtrl+0x4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_9:
   \   00000000   0x........         DC32     ?_5

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_10:
   \   00000000   0x........         DC32     sCtrl+0x3AD

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_11:
   \   00000000   0x........         DC32     sCtrl+0xAC

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_12:
   \   00000000   0x........         DC32     ?_7

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_13:
   \   00000000   0x........         DC32     ??modelstoreaddr

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_14:
   \   00000000   0x........         DC32     l_sCalcModel

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_15:
   \   00000000   0x........         DC32     sCtrl+0xB4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_16:
   \   00000000   0x........         DC32     ?_10

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_17:
   \   00000000   0x........         DC32     ?_11

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_18:
   \   00000000   0x........         DC32     ?_12

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable2_19:
   \   00000000   0x000F4240         DC32     0xf4240

   \                                 In section .rodata, align 4
   \   00000000   0x25 0x38          DC8 "%8d"
   \              0x64 0x00    

   \                                 In section .rodata, align 4
   \                     ?_1:
   \   00000000   0x25 0x30          DC8 "%02d-%02d-%02d"
   \              0x32 0x64    
   \              0x2D 0x25    
   \              0x30 0x32    
   \              0x64 0x2D    
   \              0x25 0x30    
   \              0x32 0x64    
   \              0x00         
   \   0000000F   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     ?_2:
   \   00000000   0x25 0x34          DC8 "%4d.%4d"
   \              0x64 0x2E    
   \              0x25 0x34    
   \              0x64 0x00    

   \                                 In section .rodata, align 4
   \                     ?_3:
   \   00000000   0x20 0x20          DC8 "    good"
   \              0x20 0x20    
   \              0x67 0x6F    
   \              0x6F 0x64    
   \              0x00         
   \   00000009   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     ?_4:
   \   00000000   0x20 0x20          DC8 "         "
   \              0x20 0x20    
   \              0x20 0x20    
   \              0x20 0x20    
   \              0x20 0x00    
   \   0000000A   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     ?_5:
   \   00000000   0x20 0x20          DC8 "    CALL"
   \              0x20 0x20    
   \              0x43 0x41    
   \              0x4C 0x4C    
   \              0x00         
   \   00000009   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \   00000000   0x25 0x64          DC8 "%d"
   \              0x00         
   \   00000003   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     ?_7:
   \   00000000   0x72 0x74          DC8 "rt-%d"
   \              0x2D 0x25    
   \              0x64 0x00    
   \   00000006   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 1
   \   00000000   0x00               DC8 ""

   \                                 In section .rodata, align 4
   \   00000000   0x62 0x6F          DC8 "boX"
   \              0x58 0x00    

   \                                 In section .rodata, align 4
   \                     ?_10:
   \   00000000   0x6F 0x2E          DC8 "o..%2d"
   \              0x2E 0x25    
   \              0x32 0x64    
   \              0x00         
   \   00000007   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     ?_11:
   \   00000000   0x53 0x45          DC8 "SET--"
   \              0x54 0x2D    
   \              0x2D 0x00    
   \   00000006   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     ?_12:
   \   00000000   0x53 0x45          DC8 "SET-%d"
   \              0x54 0x2D    
   \              0x25 0x64    
   \              0x00         
   \   00000007   0x00               DC8 0
    575          
    576          
    577          /*******************************************************************************
    578          * 				end of file
    579          *******************************************************************************/
    580          #endif
    581          
    582          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      72   comm_para_flow
        72   -> BSP_DispClrAll
        72   -> CSNC_SendData
        72   -> FRAM_StoreCalcModel
        72   -> FRAM_StoreOilPara
        72   -> FRAM_StoreProductInfo
        72   -> FRAM_StoreRecNumMgr
        72   -> FRAM_StoreRunPara
        72   -> GetCrc16Check
        72   -> GetOilPara
        72   -> ReadTime
        72   -> Restart
        72   -> SetDispNow
        72   -> WriteFM24CL64
        72   -> WriteTime
        72   -> __aeabi_memcpy
        72   -> comm_record_send_one
        72   -> osal_start_timerRl
        72   -> uprintf
      16   comm_record_send
        16   -> CPU_IntDisMeasStart
        16   -> CPU_IntDisMeasStop
        16   -> CPU_SR_Restore
        16   -> CPU_SR_Save
        16   -> FRAM_StoreRecNumMgr
        16   -> comm_record_send_one
        16   -> osal_start_timerRl
      32   comm_record_send_one
        32   -> CSNC_SendData
        32   -> FRAM_StoreRecNumMgr
        32   -> ReadFlshRec
        32   -> osal_start_timerRl


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable0
       4  ??DataTable1
       4  ??DataTable1_1
       4  ??DataTable2
       4  ??DataTable2_1
       4  ??DataTable2_10
       4  ??DataTable2_11
       4  ??DataTable2_12
       4  ??DataTable2_13
       4  ??DataTable2_14
       4  ??DataTable2_15
       4  ??DataTable2_16
       4  ??DataTable2_17
       4  ??DataTable2_18
       4  ??DataTable2_19
       4  ??DataTable2_2
       4  ??DataTable2_3
       4  ??DataTable2_4
       4  ??DataTable2_5
       4  ??DataTable2_6
       4  ??DataTable2_7
       4  ??DataTable2_8
       4  ??DataTable2_9
       4  ?_0
      16  ?_1
       8  ?_10
       8  ?_11
       8  ?_12
       8  ?_2
      12  ?_3
      12  ?_4
      12  ?_5
       4  ?_6
       8  ?_7
       1  ?_8
       4  ?_9
    1266  comm_para_flow
     118  comm_record_send
     292  comm_record_send_one
       4  modelstoreaddr

 
     4 bytes in section .bss
   105 bytes in section .rodata
 1 768 bytes in section .text
 
 1 768 bytes of CODE  memory
   105 bytes of CONST memory
     4 bytes of DATA  memory

Errors: none
Warnings: 6
