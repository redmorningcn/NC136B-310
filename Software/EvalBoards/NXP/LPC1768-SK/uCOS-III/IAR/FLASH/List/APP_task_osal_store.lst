###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.1.10123/W32 for ARM       11/Oct/2017  19:05:45
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        F:\iar\NC136B-310统计模块\Software\APP\Tasks\APP_task_osal_store.c
#    Command line =  
#        F:\iar\NC136B-310统计模块\Software\APP\Tasks\APP_task_osal_store.c
#        -lCN
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List
#        --diag_suppress Pa050 -o
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M3 -e --fpu=None --dlib_config "C:\Program Files
#        (x86)\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Normal.h" -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\OS\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\LPC1768\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\Generic\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\CSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-LIB\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\ARM-Cortex-M3\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Cfg\Template\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Os\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\OS\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\Ports\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Iap\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Protocol\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Tasks\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\AES\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\OS\OSAL\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\CSB\include\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\MX25L1602Drv\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\OCM800600T80\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\CardOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\DataDeal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\EquipmentOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Global\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\MastConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SlaveConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SpeedTest\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\csnr_package_deal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\iap\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\tax\
#        -On --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.3\arm\CMSIS\Include\"
#    List file    =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List\APP_task_osal_store.lst
#    Object file  =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj\APP_task_osal_store.o
#
###############################################################################

F:\iar\NC136B-310统计模块\Software\APP\Tasks\APP_task_osal_store.c
      1          /*******************************************************************************
      2           *   Filename:       app_task_store.c
      3           *   Revised:        All copyrights reserved to redmorningcn.
      4           *   Revision:       v1.0
      5           *   Writer:	     redmorningcn.
      6           *
      7           *   Description:    双击选中 store 按 Ctrl + H, 钩选 Match the case, Replace with
      8           *                   输入您要的名字，点击 Replace All
      9           *                   双击选中 Store 按 Ctrl + H, 钩选 Match the case, Replace with
     10           *                   输入您要的名字，点击 Replace All
     11           *                   双击选中 STORE 按 Ctrl + H, 钩选 Match the case, Replace with
     12           *                   输入您要的名字，点击 Replace All
     13           *                   在 app_cfg.h 中指定本任务的 优先级  （ APP_TASK_STORE_PRIO ）
     14           *                                            和 任务堆栈（ APP_TASK_STORE_STK_SIZE ）大小
     15           *                   在 app.h 中声明本任务的     创建函数（ void  App_TaskStoreCreate(void) ）
     16           *                                            和 看门狗标志位 （ WDTFLAG_Store ）
     17           *
     18           *   Notes:
     19           *     				E-mail: redmorningcn@qq.com
     20           *
     21           *******************************************************************************/
     22          
     23          /*******************************************************************************
     24           * INCLUDES
     25           */
     26          #define  SNL_APP_SOURCE
     27          #include <includes.h>
     28          #include <global.h>
     29          #include <app_ctrl.h>
     30          #include <CardDataTypeDef.h>
     31          #include <cpu.h>
     32          #include "app_tax.h"
     33               
     34          
     35          #ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
     36          const  CPU_CHAR  *app_task_store__c = "$Id: $";
     37          #endif
     38          
     39          #define APP_TASK_STORE_EN     DEF_ENABLED
     40          #if APP_TASK_STORE_EN == DEF_ENABLED				//
     41          /*******************************************************************************
     42           * CONSTANTS
     43           */
     44          
     45          /*******************************************************************************
     46           * MACROS
     47           */
     48          #define		START_EVT		31		
     49          
     50          /*******************************************************************************
     51           * TYPEDEFS
     52           */
     53          
     54          /*******************************************************************************
     55           * LOCAL VARIABLES
     56           */
     57          
     58          #if ( OSAL_EN == DEF_ENABLED )
     59          #else
     60          /***********************************************
     61          * 描述： 任务控制块（TCB）
     62          */
     63          static  OS_TCB   AppTaskStoreTCB;
     64          
     65          /***********************************************
     66          * 描述： 任务堆栈（STACKS）
     67          */
     68          //static  CPU_STK  AppTaskStoreStk[ APP_TASK_STORE_STK_SIZE ];
     69          
     70          #endif
     71          /*******************************************************************************
     72           * GLOBAL VARIABLES
     73           */
     74          
     75          /*******************************************************************************
     76           * LOCAL FUNCTIONS
     77           */
     78          #if ( OSAL_EN == DEF_ENABLED )
     79          #else
     80          extern	void    BSP_StoreInit(void);
     81          #endif
     82          
     83          /*******************************************************************************
     84           * GLOBAL FUNCTIONS
     85           */
     86          
     87          /*******************************************************************************
     88           * EXTERN VARIABLES
     89           */
     90          extern	stcSysCtrl       sCtrl;       	//	全局结构控制体
     91          /*******************************************************************************/
     92          
     93          /*******************************************************************************
     94           * 名    称： 		GetRecNumAddr
     95           * 功    能：      取数据记录地址。
     96                          flash地址;更新记录号等信息。
     97           * 入口参数： 	无
     98           * 出口参数： 	无
     99           * 作　 　者： 	redmornigcn
    100           * 创建日期： 	2017-05-15
    101           * 修    改：
    102           * 修改日期：
    103           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    104          uint32  GetRecNumAddr(uint32 FlshRecNum)
    105          {				
    106              return  (uint32)(((FlshRecNum * sizeof(stcFlshRec)) % FLSH_MAX_SIZE)); 			
   \                     GetRecNumAddr: (+1)
   \   00000000   0x2180             MOVS     R1,#+128
   \   00000002   0xFB01 0xF100      MUL      R1,R1,R0
   \   00000006   0xF45F 0x0200      MOVS     R2,#+8388608
   \   0000000A   0xFBB1 0xF0F2      UDIV     R0,R1,R2
   \   0000000E   0xFB00 0x1012      MLS      R0,R0,R2,R1
   \   00000012   0x4770             BX       LR               ;; return
    107          }
    108          
    109          
    110          /*******************************************************************************
    111           * 名    称： 	GetTaxInfoToRecord
    112           * 功    能：   取TAX箱信息
    113           * 入口参数： 	无
    114           * 出口参数： 	无
    115           * 作　 　者： 	redmornigcn
    116           * 创建日期： 	2017-09-15
    117           * 修    改：
    118           * 修改日期：
    119           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    120          uint32  GetTaxInfoToRecord(stcFlshRec *sFlshRec)
    121          {
   \                     GetTaxInfoToRecord: (+1)
   \   00000000   0xE92D 0x4FF8      PUSH     {R3-R11,LR}
   \   00000004   0x0004             MOVS     R4,R0
    122              if(sCtrl.Tax.ConnectFlag == 1)              //收到tax箱信息，将数据复制到数据记录
   \   00000006   0x.... 0x....      LDR.W    R0,??DataTable4
   \   0000000A   0xF890 0x08E4      LDRB     R0,[R0, #+2276]
   \   0000000E   0x2801             CMP      R0,#+1
   \   00000010   0xF040 0x8094      BNE.W    ??GetTaxInfoToRecord_0
    123              {
    124                  if(sCtrl.Tax.TaxType == TAX2_SET)       //TAX2
   \   00000014   0x.... 0x....      LDR.W    R0,??DataTable4
   \   00000018   0xF890 0x08E5      LDRB     R0,[R0, #+2277]
   \   0000001C   0x28F0             CMP      R0,#+240
   \   0000001E   0xF040 0x808D      BNE.W    ??GetTaxInfoToRecord_1
    125                  {
    126                      sCtrl.Tax.ConnectFlag = 0;          //清已取信息
   \   00000022   0x2000             MOVS     R0,#+0
   \   00000024   0x.... 0x....      LDR.W    R1,??DataTable4
   \   00000028   0xF881 0x08E4      STRB     R0,[R1, #+2276]
    127                      
    128                      memcpy(&sFlshRec->RelSpeed,&sCtrl.Tax.Dat.Tax2.sTAX2Bak.RelSpeed,sizeof(sFlshRec->RelSpeed));
   \   0000002C   0x2503             MOVS     R5,#+3
   \   0000002E   0x.... 0x....      LDR.W    R6,??DataTable4_1
   \   00000032   0x1D67             ADDS     R7,R4,#+5
   \   00000034   0x002A             MOVS     R2,R5
   \   00000036   0x0031             MOVS     R1,R6
   \   00000038   0x0038             MOVS     R0,R7
   \   0000003A   0x.... 0x....      BL       __aeabi_memcpy
    129                      memcpy(&sFlshRec->TrainNum,&sCtrl.Tax.Dat.Tax2.sTAX2Bak.TrainNum,sizeof(sFlshRec->TrainNum));
   \   0000003E   0x2703             MOVS     R7,#+3
   \   00000040   0x.... 0x....      LDR.W    R8,??DataTable4_2
   \   00000044   0xF114 0x0914      ADDS     R9,R4,#+20
   \   00000048   0x003A             MOVS     R2,R7
   \   0000004A   0x4641             MOV      R1,R8
   \   0000004C   0x4648             MOV      R0,R9
   \   0000004E   0x.... 0x....      BL       __aeabi_memcpy
    130                      memcpy(&sFlshRec->KmMark,&sCtrl.Tax.Dat.Tax2.sTAX2Bak.KmMark,sizeof(sFlshRec->KmMark));
   \   00000052   0xF05F 0x0903      MOVS     R9,#+3
   \   00000056   0x.... 0x....      LDR.W    R10,??DataTable4_3
   \   0000005A   0xF114 0x0B19      ADDS     R11,R4,#+25
   \   0000005E   0x464A             MOV      R2,R9
   \   00000060   0x4651             MOV      R1,R10
   \   00000062   0x4658             MOV      R0,R11
   \   00000064   0x.... 0x....      BL       __aeabi_memcpy
    131          
    132                      sFlshRec->Time          = sCtrl.Tax.Dat.Tax2.sTAX2Bak.Time;
   \   00000068   0x.... 0x....      LDR.W    R0,??DataTable4
   \   0000006C   0xF8D0 0x08BB      LDR      R0,[R0, #+2235]
   \   00000070   0x60A0             STR      R0,[R4, #+8]
    133                      sFlshRec->LocoTyp       = sCtrl.Tax.Dat.Tax2.sTAX2Bak.LocoTyp;
   \   00000072   0x.... 0x....      LDR.W    R0,??DataTable4
   \   00000076   0xF890 0x08DA      LDRB     R0,[R0, #+2266]
   \   0000007A   0x7320             STRB     R0,[R4, #+12]
    134                      sFlshRec->E_LocoTyp     = sCtrl.Tax.Dat.Tax2.sTAX2Bef.E_LocoTyp;
   \   0000007C   0x.... 0x....      LDR.W    R0,??DataTable4
   \   00000080   0xF890 0x08A6      LDRB     R0,[R0, #+2214]
   \   00000084   0x7360             STRB     R0,[R4, #+13]
    135                      sFlshRec->LocoNum       = sCtrl.Tax.Dat.Tax2.sTAX2Bak.LocoNum;
   \   00000086   0x.... 0x....      LDR.W    R0,??DataTable4
   \   0000008A   0xF8B0 0x08D8      LDRH     R0,[R0, #+2264]
   \   0000008E   0x81E0             STRH     R0,[R4, #+14]
    136                      sFlshRec->TrainTyp      = sCtrl.Tax.Dat.Tax2.sTAX2Bef.TrainTyp;
   \   00000090   0x.... 0x....      LDR.W    R0,??DataTable4
   \   00000094   0xF8D0 0x089E      LDR      R0,[R0, #+2206]
   \   00000098   0x6120             STR      R0,[R4, #+16]
    137                      sFlshRec->Car_Truck     = sCtrl.Tax.Dat.Tax2.sTAX2Bak.Car_Truck;
   \   0000009A   0x.... 0x....      LDR.W    R0,??DataTable4
   \   0000009E   0xF890 0x08CF      LDRB     R0,[R0, #+2255]
   \   000000A2   0x75E0             STRB     R0,[R4, #+23]
    138                      sFlshRec->VoitureCnt    = sCtrl.Tax.Dat.Tax2.sTAX2Bak.VoitureCnt;
   \   000000A4   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000A8   0xF890 0x08CE      LDRB     R0,[R0, #+2254]
   \   000000AC   0x7620             STRB     R0,[R4, #+24]
    139                      sFlshRec->Weight        = sCtrl.Tax.Dat.Tax2.sTAX2Bak.Weight;
   \   000000AE   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000B2   0xF8B0 0x08CA      LDRH     R0,[R0, #+2250]
   \   000000B6   0x83A0             STRH     R0,[R4, #+28]
    140                      sFlshRec->PlanLen       = sCtrl.Tax.Dat.Tax2.sTAX2Bak.PlanLen;
   \   000000B8   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000BC   0xF8B0 0x08CC      LDRH     R0,[R0, #+2252]
   \   000000C0   0x83E0             STRH     R0,[R4, #+30]
    141                      sFlshRec->MstDriverNum  = sCtrl.Tax.Dat.Tax2.sTAX2Bak.MstDriverNum;  
   \   000000C2   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000C6   0xF8B0 0x08D4      LDRH     R0,[R0, #+2260]
   \   000000CA   0x8420             STRH     R0,[R4, #+32]
    142                      sFlshRec->E_MstDriverNum= sCtrl.Tax.Dat.Tax2.sTAX2Bef.E_MstDriverNum;
   \   000000CC   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000D0   0xF890 0x08A2      LDRB     R0,[R0, #+2210]
   \   000000D4   0xF884 0x0022      STRB     R0,[R4, #+34]
    143                      sFlshRec->E_SlvDriverNum= sCtrl.Tax.Dat.Tax2.sTAX2Bef.E_SlvDriverNum;
   \   000000D8   0x.... 0x....      LDR.W    R0,??DataTable4
   \   000000DC   0xF890 0x08A3      LDRB     R0,[R0, #+2211]
   \   000000E0   0xF884 0x0023      STRB     R0,[R4, #+35]
    144                      sFlshRec->SlvDriverNum  = sCtrl.Tax.Dat.Tax2.sTAX2Bak.SlvDriverNum;  
   \   000000E4   0x....             LDR.N    R0,??DataTable4
   \   000000E6   0xF8B0 0x08D6      LDRH     R0,[R0, #+2262]
   \   000000EA   0x84A0             STRH     R0,[R4, #+36]
    145                      
    146                      sFlshRec->RoadNum       = sCtrl.Tax.Dat.Tax2.sTAX2Bak.RoadNum;      
   \   000000EC   0x....             LDR.N    R0,??DataTable4
   \   000000EE   0xF890 0x08D2      LDRB     R0,[R0, #+2258]
   \   000000F2   0xF884 0x0028      STRB     R0,[R4, #+40]
    147                      sFlshRec->RelRoadNum    = sCtrl.Tax.Dat.Tax2.sTAX2Bef.RelRoadNum;   
   \   000000F6   0x....             LDR.N    R0,??DataTable4
   \   000000F8   0xF890 0x08A7      LDRB     R0,[R0, #+2215]
   \   000000FC   0xF884 0x0029      STRB     R0,[R4, #+41]
    148                      sFlshRec->StationNum    = sCtrl.Tax.Dat.Tax2.sTAX2Bak.StationNum;   
   \   00000100   0x....             LDR.N    R0,??DataTable4
   \   00000102   0xF890 0x08D3      LDRB     R0,[R0, #+2259]
   \   00000106   0xF884 0x002A      STRB     R0,[R4, #+42]
    149                      sFlshRec->E_StationNum  = sCtrl.Tax.Dat.Tax2.sTAX2Bef.E_StationNum; 
   \   0000010A   0x....             LDR.N    R0,??DataTable4
   \   0000010C   0xF890 0x089D      LDRB     R0,[R0, #+2205]
   \   00000110   0xF884 0x002B      STRB     R0,[R4, #+43]
    150                      sFlshRec->SignalTyp     = sCtrl.Tax.Dat.Tax2.sTAX2Bak.SignalTyp;    
   \   00000114   0x....             LDR.N    R0,??DataTable4
   \   00000116   0xF890 0x08C6      LDRB     R0,[R0, #+2246]
   \   0000011A   0xF884 0x002C      STRB     R0,[R4, #+44]
    151                      sFlshRec->LocoSign      = sCtrl.Tax.Dat.Tax2.sTAX2Bak.LocoSign;     
   \   0000011E   0x....             LDR.N    R0,??DataTable4
   \   00000120   0xF890 0x08C2      LDRB     R0,[R0, #+2242]
   \   00000124   0xF884 0x002D      STRB     R0,[R4, #+45]
    152                      sFlshRec->LocoWorkState = sCtrl.Tax.Dat.Tax2.sTAX2Bak.LocoWorkState;
   \   00000128   0x....             LDR.N    R0,??DataTable4
   \   0000012A   0xF890 0x08C3      LDRB     R0,[R0, #+2243]
   \   0000012E   0xF884 0x002E      STRB     R0,[R4, #+46]
    153                      sFlshRec->LocoState     = sCtrl.Tax.Dat.Tax2.sTAX2Bak.LocoState;  
   \   00000132   0x....             LDR.N    R0,??DataTable4
   \   00000134   0xF890 0x08DD      LDRB     R0,[R0, #+2269]
   \   00000138   0xF884 0x002F      STRB     R0,[R4, #+47]
    154                  }
    155                  
    156                  if(sCtrl.Tax.TaxType == TAX3_SET)   //TAX3设备
    157                  {
    158                      
    159                  }
    160              }
    161          }
   \                     ??GetTaxInfoToRecord_1: (+1)
   \                     ??GetTaxInfoToRecord_0: (+1)
   \   0000013C   0xE8BD 0x8FF2      POP      {R1,R4-R11,PC}   ;; return
    162          
    163                
    164          /*******************************************************************************
    165           * 名    称：RoadNum;        		StoreData
    166           * 功    能：RelRoadNum;     		数据存储。根据数据记录号将数据存储到指定
    167           			StationNum;    		flash地址;更新记录号等信息。大部分数据记录的
    168           			E_StationNum;  		内容在其他任务直接对sCtrl.sRec 中更新。少部分
    169           					数据内容在该函数中跟新。
    170           * 入口参数：SignalTyp;      	无
    171           * 出口参数：LocoSign;       	无
    172           * 作　 　者                 ： 	redmornigcn
    173           * 创建日期：LocoWorkState;  	2017-05-15
    174           * 修    改：LocoState;     
    175           * 修改日期：
    176           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    177          void  SetRecFlsh(stcFlshRec *sFlsh)
    178          {
   \                     SetRecFlsh: (+1)
   \   00000000   0xB51C             PUSH     {R2-R4,LR}
   \   00000002   0x0004             MOVS     R4,R0
    179          
    180              stcTime             sTime;
    181          
    182          //暂时没用的数据清零    
    183              sFlsh->GpsLatitude     = 0;
   \   00000004   0x2000             MOVS     R0,#+0
   \   00000006   0x65E0             STR      R0,[R4, #+92]
    184              sFlsh->GpsLongitude    = 0;
   \   00000008   0x2000             MOVS     R0,#+0
   \   0000000A   0x65A0             STR      R0,[R4, #+88]
    185              sFlsh->MaxSpeed        = 0;
   \   0000000C   0x2000             MOVS     R0,#+0
   \   0000000E   0xF8A4 0x0074      STRH     R0,[R4, #+116]
    186              sFlsh->MstDensity      = 0;
   \   00000012   0x2000             MOVS     R0,#+0
   \   00000014   0xF8A4 0x0052      STRH     R0,[R4, #+82]
    187              sFlsh->MstDipTemp      = 0;
   \   00000018   0x2000             MOVS     R0,#+0
   \   0000001A   0xF884 0x007A      STRB     R0,[R4, #+122]
    188              sFlsh->MyAddspeed      = 0;
   \   0000001E   0x2000             MOVS     R0,#+0
   \   00000020   0xF8A4 0x0054      STRH     R0,[R4, #+84]
    189              sFlsh->MyDip1Den       = 0;
   \   00000024   0x2000             MOVS     R0,#+0
   \   00000026   0xF8A4 0x006C      STRH     R0,[R4, #+108]
    190              sFlsh->MyDip2Den       = 0;
   \   0000002A   0x2000             MOVS     R0,#+0
   \   0000002C   0xF8A4 0x006E      STRH     R0,[R4, #+110]
    191              sFlsh->MyKileMeter     = 0;
   \   00000030   0x2000             MOVS     R0,#+0
   \   00000032   0x63A0             STR      R0,[R4, #+56]
    192              sFlsh->MyMstLocoPower  = 0;
   \   00000034   0x2000             MOVS     R0,#+0
   \   00000036   0x63E0             STR      R0,[R4, #+60]
    193              sFlsh->MyPower         = 0;
   \   00000038   0x2000             MOVS     R0,#+0
   \   0000003A   0x6420             STR      R0,[R4, #+64]
    194              sFlsh->Reserve1        = 0;
   \   0000003C   0x2000             MOVS     R0,#+0
   \   0000003E   0xF884 0x007D      STRB     R0,[R4, #+125]
    195              sFlsh->SlvDip1Prs      = 0;
   \   00000042   0x2000             MOVS     R0,#+0
   \   00000044   0xF8A4 0x0048      STRH     R0,[R4, #+72]
    196              sFlsh->SlvDip2Prs      = 0;
   \   00000048   0x2000             MOVS     R0,#+0
   \   0000004A   0xF8A4 0x004A      STRH     R0,[R4, #+74]
    197          
    198          //  数据记录内容更新在应用中进行。
    199          //	数据内容存储在sCtrl.sRec 中。
    200                   
    201          /*
    202          速度1，速度2，柴油机转速，工况，在app_task_osal_speed中更新
    203          油量，在app_task_osal_calc中更新
    204          高度1，高度2，在app_task_oasl_comm中更新
    205          */    
    206          //  存储时更新的内容
    207          	sFlsh->StoreCnt = sCtrl.sRecNumMgr.Current;     //取当前数据记录号	
   \   0000004E   0x....             LDR.N    R0,??DataTable4
   \   00000050   0x6840             LDR      R0,[R0, #+4]
   \   00000052   0x6020             STR      R0,[R4, #+0]
    208          
    209          //  装置时间:年-月-日，时-分-秒
    210          	ReadTime((stcTime *)&sTime);
   \   00000054   0x4668             MOV      R0,SP
   \   00000056   0x.... 0x....      BL       ReadTime
    211          
    212          	sCtrl.sRec.MyYear		= sTime.Year;			
   \   0000005A   0xF89D 0x0005      LDRB     R0,[SP, #+5]
   \   0000005E   0x....             LDR.N    R1,??DataTable4
   \   00000060   0xF881 0x006C      STRB     R0,[R1, #+108]
    213          	sCtrl.sRec.MyMonth	    = sTime.Month;		
   \   00000064   0xF89D 0x0004      LDRB     R0,[SP, #+4]
   \   00000068   0x....             LDR.N    R1,??DataTable4
   \   0000006A   0xF881 0x006D      STRB     R0,[R1, #+109]
    214          	sCtrl.sRec.MyData		= sTime.Date;			
   \   0000006E   0xF89D 0x0003      LDRB     R0,[SP, #+3]
   \   00000072   0x....             LDR.N    R1,??DataTable4
   \   00000074   0xF881 0x006E      STRB     R0,[R1, #+110]
    215          	sCtrl.sRec.MyHour		= sTime.Hour;			
   \   00000078   0xF89D 0x0002      LDRB     R0,[SP, #+2]
   \   0000007C   0x....             LDR.N    R1,??DataTable4
   \   0000007E   0xF881 0x006F      STRB     R0,[R1, #+111]
    216          	sCtrl.sRec.MyMinute	    = sTime.Min;			
   \   00000082   0xF89D 0x0001      LDRB     R0,[SP, #+1]
   \   00000086   0x....             LDR.N    R1,??DataTable4
   \   00000088   0xF881 0x0070      STRB     R0,[R1, #+112]
    217          	sCtrl.sRec.MySecond	    = sTime.Sec;			
   \   0000008C   0xF89D 0x0000      LDRB     R0,[SP, #+0]
   \   00000090   0x....             LDR.N    R1,??DataTable4
   \   00000092   0xF881 0x0071      STRB     R0,[R1, #+113]
    218          
    219          //开机标示
    220              sFlsh->RecTypCod = 0xff;                    //正常
   \   00000096   0x20FF             MOVS     R0,#+255
   \   00000098   0x7120             STRB     R0,[R4, #+4]
    221              if(sCtrl.sRunPara.StartFlg)
   \   0000009A   0x....             LDR.N    R0,??DataTable4
   \   0000009C   0xF890 0x00C7      LDRB     R0,[R0, #+199]
   \   000000A0   0x2800             CMP      R0,#+0
   \   000000A2   0xD005             BEQ.N    ??SetRecFlsh_0
    222              {
    223                  sFlsh->RecTypCod        = START_EVT;           //_C          
   \   000000A4   0x201F             MOVS     R0,#+31
   \   000000A6   0x7120             STRB     R0,[R4, #+4]
    224                  sCtrl.sRunPara.StartFlg = 0;
   \   000000A8   0x2000             MOVS     R0,#+0
   \   000000AA   0x....             LDR.N    R1,??DataTable4
   \   000000AC   0xF881 0x00C7      STRB     R0,[R1, #+199]
    225              }
    226              else
    227              {
    228                  //sCtrl.sRec.RecTypCod = 
    229              }
    230                  
    231              
    232          //存储机车信息
    233              sFlsh->JcRealType   = sCtrl.sProductInfo.sLocoId.Type;
   \                     ??SetRecFlsh_0: (+1)
   \   000000B0   0x....             LDR.N    R0,??DataTable4
   \   000000B2   0x8B80             LDRH     R0,[R0, #+28]
   \   000000B4   0xF8A4 0x0064      STRH     R0,[R4, #+100]
    234              sFlsh->JcRealNo     = sCtrl.sProductInfo.sLocoId.Num;
   \   000000B8   0x....             LDR.N    R0,??DataTable4
   \   000000BA   0x8BC0             LDRH     R0,[R0, #+30]
   \   000000BC   0xF8A4 0x0066      STRH     R0,[R4, #+102]
    235          
    236          //软件版本    
    237              sFlsh->SoftVes 	    = sCtrl.SoftWareID;     
   \   000000C0   0x....             LDR.N    R0,??DataTable4
   \   000000C2   0x8840             LDRH     R0,[R0, #+2]
   \   000000C4   0xF884 0x007C      STRB     R0,[R4, #+124]
    238          //故障代码
    239          //    sCtrl.sRec.ErrorCode    = 
    240          
    241          //运算参数
    242              sFlsh->OilBoxModel  = sCtrl.SOilPara.ModelNum;
   \   000000C8   0x....             LDR.N    R0,??DataTable4
   \   000000CA   0xF890 0x00A0      LDRB     R0,[R0, #+160]
   \   000000CE   0xF884 0x007B      STRB     R0,[R4, #+123]
    243          //    sCtrl.sRec.
    244                  
    245          // 	保存TAX箱信息 
    246              GetTaxInfoToRecord(sFlsh);
   \   000000D2   0x0020             MOVS     R0,R4
   \   000000D4   0x.... 0x....      BL       GetTaxInfoToRecord
    247               
    248          // 	计算记录校验和
    249          	sFlsh->CrcCheck = GetCrc16Check((uint8 *)sFlsh,sizeof(stcFlshRec) - 2);
   \   000000D8   0x217E             MOVS     R1,#+126
   \   000000DA   0x0020             MOVS     R0,R4
   \   000000DC   0x.... 0x....      BL       GetCrc16Check
   \   000000E0   0xF8A4 0x007E      STRH     R0,[R4, #+126]
    250              
    251          }
   \   000000E4   0xBD13             POP      {R0,R1,R4,PC}    ;; return
    252          
    253          /*******************************************************************************
    254           * 名    称：RoadNum;        		StoreData
    255           * 功    能：RelRoadNum;     		数据存储。根据数据记录号将数据存储到指定
    256           			StationNum;    		flash地址;更新记录号等信息。大部分数据记录的
    257           			E_StationNum;  		内容在其他任务直接对sCtrl.sRec 中更新。少部分
    258           					数据内容在该函数中跟新。
    259           * 入口参数：SignalTyp;      	无
    260           * 出口参数：LocoSign;       	无
    261           * 作　 　者                 ： 	redmornigcn
    262           * 创建日期：LocoWorkState;  	2017-05-15
    263           * 修    改：LocoState;     
    264           * 修改日期：
    265           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    266          void  SetRecFlsh_NDP02B(stcFlshRecNDP02B *sFlsh)
    267          {
   \                     SetRecFlsh_NDP02B: (+1)
   \   00000000   0xB5F0             PUSH     {R4-R7,LR}
   \   00000002   0xB083             SUB      SP,SP,#+12
   \   00000004   0x0004             MOVS     R4,R0
    268          
    269              stcTime             sTime;
    270          
    271          
    272              sFlsh->CmdTpye		 = 0;                                   //命令类型       1    
   \   00000006   0x2000             MOVS     R0,#+0
   \   00000008   0x7020             STRB     R0,[R4, #+0]
    273           
    274           //开机标示
    275              sFlsh->EvtType       =  0xff   ;                            //事件类型       1    
   \   0000000A   0x20FF             MOVS     R0,#+255
   \   0000000C   0x7060             STRB     R0,[R4, #+1]
    276              if(sCtrl.sRunPara.StartFlg)
   \   0000000E   0x....             LDR.N    R0,??DataTable4
   \   00000010   0xF890 0x00C7      LDRB     R0,[R0, #+199]
   \   00000014   0x2800             CMP      R0,#+0
   \   00000016   0xD005             BEQ.N    ??SetRecFlsh_NDP02B_0
    277              {
    278                  sFlsh->EvtType  = START_EVT;                             //_C          
   \   00000018   0x201F             MOVS     R0,#+31
   \   0000001A   0x7060             STRB     R0,[R4, #+1]
    279                  sCtrl.sRunPara.StartFlg = 0;
   \   0000001C   0x2000             MOVS     R0,#+0
   \   0000001E   0x....             LDR.N    R1,??DataTable4
   \   00000020   0xF881 0x00C7      STRB     R0,[R1, #+199]
    280              }   
    281              
    282              sFlsh->LocoType      =   sCtrl.sProductInfo.sLocoId.Type  ;//机车型号       2                  
   \                     ??SetRecFlsh_NDP02B_0: (+1)
   \   00000024   0x....             LDR.N    R0,??DataTable4
   \   00000026   0x8B80             LDRH     R0,[R0, #+28]
   \   00000028   0x8060             STRH     R0,[R4, #+2]
    283              sFlsh->LocoNum       =   sCtrl.sProductInfo.sLocoId.Num   ;//机 车 号       2                     
   \   0000002A   0x....             LDR.N    R0,??DataTable4
   \   0000002C   0x8BC0             LDRH     R0,[R0, #+30]
   \   0000002E   0x80A0             STRH     R0,[R4, #+4]
    284              sFlsh->SysID         =   sCtrl.sRecNumMgr.Current;         //记录流水号     4                   
   \   00000030   0x....             LDR.N    R0,??DataTable4
   \   00000032   0x6840             LDR      R0,[R0, #+4]
   \   00000034   0xF8C4 0x0006      STR      R0,[R4, #+6]
    285              sFlsh->Oil           =   sCtrl.sRec.MstDip      ;//油量           2                    
   \   00000038   0x....             LDR.N    R0,??DataTable4
   \   0000003A   0x6D40             LDR      R0,[R0, #+84]
   \   0000003C   0x8160             STRH     R0,[R4, #+10]
    286              sFlsh->Hight1        =   sCtrl.sRec.Myhig1  ;//高度1          2                    
   \   0000003E   0x....             LDR.N    R0,??DataTable4
   \   00000040   0xF8B0 0x0064      LDRH     R0,[R0, #+100]
   \   00000044   0x81A0             STRH     R0,[R4, #+12]
    287              sFlsh->Hight2        =   sCtrl.sRec.Myhig2  ;//高度2          2                    
   \   00000046   0x....             LDR.N    R0,??DataTable4
   \   00000048   0xF8B0 0x0066      LDRH     R0,[R0, #+102]
   \   0000004C   0x81E0             STRH     R0,[R4, #+14]
    288              sFlsh->Pressure1     =   0  ;//压力1          2                    
   \   0000004E   0x2000             MOVS     R0,#+0
   \   00000050   0x8220             STRH     R0,[R4, #+16]
    289              sFlsh->Pressure2     =   0  ;//压力2          2                    
   \   00000052   0x2000             MOVS     R0,#+0
   \   00000054   0x8260             STRH     R0,[R4, #+18]
    290              sFlsh->Density1      =   sCtrl.sRec.MyDip1Den  ;//密度1          2                    
   \   00000056   0x....             LDR.N    R0,??DataTable4
   \   00000058   0xF8B0 0x008C      LDRH     R0,[R0, #+140]
   \   0000005C   0x82A0             STRH     R0,[R4, #+20]
    291              sFlsh->Density2      =   sCtrl.sRec.MyDip1Den   ;//密度2          2                    
   \   0000005E   0x....             LDR.N    R0,??DataTable4
   \   00000060   0xF8B0 0x008C      LDRH     R0,[R0, #+140]
   \   00000064   0x82E0             STRH     R0,[R4, #+22]
    292              sFlsh->TempOil       =   0  ;//油箱温度       1                  
   \   00000066   0x2000             MOVS     R0,#+0
   \   00000068   0x7620             STRB     R0,[R4, #+24]
    293              sFlsh->TempEnv       =   0  ;//环境温度       1                  
   \   0000006A   0x2000             MOVS     R0,#+0
   \   0000006C   0x7660             STRB     R0,[R4, #+25]
    294              sFlsh->Degree        =   0  ;//电量           4                    
   \   0000006E   0x2000             MOVS     R0,#+0
   \   00000070   0xF8C4 0x001A      STR      R0,[R4, #+26]
    295              sFlsh->Power         =   0  ;//功率           2                    
   \   00000074   0x2000             MOVS     R0,#+0
   \   00000076   0x83E0             STRH     R0,[R4, #+30]
    296              sFlsh->Voltage       =   0  ;//电压           2                    
   \   00000078   0x2000             MOVS     R0,#+0
   \   0000007A   0x8420             STRH     R0,[R4, #+32]
    297              sFlsh->Current       =   0  ;//电流           2                    
   \   0000007C   0x2000             MOVS     R0,#+0
   \   0000007E   0x8460             STRH     R0,[R4, #+34]
    298              sFlsh->EngineSpeed   =   sCtrl.sRec.MyEngRotSpd  ;//柴速           2                    
   \   00000080   0x....             LDR.N    R0,??DataTable4
   \   00000082   0xF8B0 0x0082      LDRH     R0,[R0, #+130]
   \   00000086   0x84A0             STRH     R0,[R4, #+36]
    299              sFlsh->Longitude     =   0  ;//经度           4                    
   \   00000088   0x2000             MOVS     R0,#+0
   \   0000008A   0xF8C4 0x0026      STR      R0,[R4, #+38]
    300              sFlsh->Latitude	     =   0  ;//纬度           4                    
   \   0000008E   0x2000             MOVS     R0,#+0
   \   00000090   0xF8C4 0x002A      STR      R0,[R4, #+42]
    301              sFlsh->AddSpeed      =   0  ;//加速度         2                     
   \   00000094   0x2000             MOVS     R0,#+0
   \   00000096   0x85E0             STRH     R0,[R4, #+46]
    302              sFlsh->Rssi          =   0  ;//信号强度       1                  
   \   00000098   0xF8D4 0x002D      LDR      R0,[R4, #+45]
   \   0000009C   0xF030 0x507C      BICS     R0,R0,#0x3F000000
   \   000000A0   0xF8C4 0x002D      STR      R0,[R4, #+45]
    303              sFlsh->ErrCode       =   0  ;//故障代码       3                  
   \   000000A4   0x6B20             LDR      R0,[R4, #+48]
   \   000000A6   0xF36F 0x109D      BFC      R0,#+6,#+24
   \   000000AA   0x6320             STR      R0,[R4, #+48]
    304              sFlsh->ModelCode     =   sCtrl.sRec.OilBoxModel   ;//模型编号       1                  
   \   000000AC   0x....             LDR.N    R0,??DataTable4
   \   000000AE   0xF890 0x009B      LDRB     R0,[R0, #+155]
   \   000000B2   0xF884 0x0034      STRB     R0,[R4, #+52]
    305              sFlsh->DevConfig     =   0  ;//通讯设备配      1                   
   \   000000B6   0x2000             MOVS     R0,#+0
   \   000000B8   0xF884 0x0035      STRB     R0,[R4, #+53]
    306              sFlsh->Recv          =   0  ;//预留           6          
   \   000000BC   0x2000             MOVS     R0,#+0
   \   000000BE   0x86E0             STRH     R0,[R4, #+54]
    307          
    308          
    309          //  数据记录内容更新在应用中进行。
    310          //	数据内容存储在sCtrl.sRec 中。
    311                   
    312          /*
    313          速度1，速度2，柴油机转速，工况，在app_task_osal_speed中更新
    314          油量，在app_task_osal_calc中更新
    315          高度1，高度2，在app_task_oasl_comm中更新
    316          */    
    317          //  存储时更新的内容
    318              
    319          //  装置时间:年-月-日，时-分-秒
    320          	
    321              memset((uint8_t *)&sFlsh->Tax.buf1[0],0,sizeof(sFlsh->Tax.buf1));//clear
   \   000000C0   0x2540             MOVS     R5,#+64
   \   000000C2   0x2600             MOVS     R6,#+0
   \   000000C4   0xF114 0x073E      ADDS     R7,R4,#+62
   \   000000C8   0x0032             MOVS     R2,R6
   \   000000CA   0x0029             MOVS     R1,R5
   \   000000CC   0x0038             MOVS     R0,R7
   \   000000CE   0x.... 0x....      BL       __aeabi_memset
    322              
    323              ReadTime((stcTime *)&sTime);
   \   000000D2   0x4668             MOV      R0,SP
   \   000000D4   0x.... 0x....      BL       ReadTime
    324          
    325          	sFlsh->Tax.Tax2.LKJTime.Year    = sTime.Year;			
   \   000000D8   0xF89D 0x0005      LDRB     R0,[SP, #+5]
   \   000000DC   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   000000E0   0xF360 0x619F      BFI      R1,R0,#+26,#+6
   \   000000E4   0xF8C4 0x105B      STR      R1,[R4, #+91]
    326          	sFlsh->Tax.Tax2.LKJTime.Mon	    = sTime.Month;		
   \   000000E8   0xF89D 0x0004      LDRB     R0,[SP, #+4]
   \   000000EC   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   000000F0   0xF360 0x5199      BFI      R1,R0,#+22,#+4
   \   000000F4   0xF8C4 0x105B      STR      R1,[R4, #+91]
    327          	sFlsh->Tax.Tax2.LKJTime.Day     = sTime.Date;			
   \   000000F8   0xF89D 0x0003      LDRB     R0,[SP, #+3]
   \   000000FC   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   00000100   0xF360 0x4155      BFI      R1,R0,#+17,#+5
   \   00000104   0xF8C4 0x105B      STR      R1,[R4, #+91]
    328          	sFlsh->Tax.Tax2.LKJTime.Hour    = sTime.Hour;			
   \   00000108   0xF89D 0x0002      LDRB     R0,[SP, #+2]
   \   0000010C   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   00000110   0xF360 0x3110      BFI      R1,R0,#+12,#+5
   \   00000114   0xF8C4 0x105B      STR      R1,[R4, #+91]
    329          	sFlsh->Tax.Tax2.LKJTime.Min     = sTime.Min;			
   \   00000118   0xF89D 0x0001      LDRB     R0,[SP, #+1]
   \   0000011C   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   00000120   0xF360 0x118B      BFI      R1,R0,#+6,#+6
   \   00000124   0xF8C4 0x105B      STR      R1,[R4, #+91]
    330          	sFlsh->Tax.Tax2.LKJTime.Sec     = sTime.Sec;			
   \   00000128   0xF89D 0x0000      LDRB     R0,[SP, #+0]
   \   0000012C   0xF8D4 0x105B      LDR      R1,[R4, #+91]
   \   00000130   0xF360 0x0105      BFI      R1,R0,#+0,#+6
   \   00000134   0xF8C4 0x105B      STR      R1,[R4, #+91]
    331          
    332              if(sCtrl.Tax.ConnectFlag == 1)              //收到tax箱信息，将数据复制到数据记录
   \   00000138   0x....             LDR.N    R0,??DataTable4
   \   0000013A   0xF890 0x08E4      LDRB     R0,[R0, #+2276]
   \   0000013E   0x2801             CMP      R0,#+1
   \   00000140   0xD112             BNE.N    ??SetRecFlsh_NDP02B_1
    333              {
    334              // 	保存TAX箱信息 
    335                  sFlsh->TaxType   = sCtrl.Tax.Dat.Tax2A.Record.Addr;
   \   00000142   0x....             LDR.N    R0,??DataTable4
   \   00000144   0xF890 0x08B8      LDRB     R0,[R0, #+2232]
   \   00000148   0xF884 0x003C      STRB     R0,[R4, #+60]
    336                  sFlsh->TaxFlg    = sCtrl.Tax.Dat.Tax2A.CheZhanHaoKuoChong;
   \   0000014C   0x....             LDR.N    R0,??DataTable4
   \   0000014E   0xF890 0x089D      LDRB     R0,[R0, #+2205]
   \   00000152   0xF884 0x003D      STRB     R0,[R4, #+61]
    337                  memcpy((uint8_t *)&sFlsh->Tax.buf1[0],(uint8_t *)&sCtrl.Tax.Dat.buf1[6],64);
   \   00000156   0x2540             MOVS     R5,#+64
   \   00000158   0x....             LDR.N    R6,??DataTable4_4
   \   0000015A   0xF114 0x073E      ADDS     R7,R4,#+62
   \   0000015E   0x002A             MOVS     R2,R5
   \   00000160   0x0031             MOVS     R1,R6
   \   00000162   0x0038             MOVS     R0,R7
   \   00000164   0x.... 0x....      BL       __aeabi_memcpy
    338              }
    339              
    340          // 	计算记录校验和
    341          	sFlsh->CrcCheck = GetCrc16Check((uint8 *)sFlsh,sizeof(stcFlshRecNDP02B) - 2);
   \                     ??SetRecFlsh_NDP02B_1: (+1)
   \   00000168   0x217E             MOVS     R1,#+126
   \   0000016A   0x0020             MOVS     R0,R4
   \   0000016C   0x.... 0x....      BL       GetCrc16Check
   \   00000170   0xF8A4 0x007E      STRH     R0,[R4, #+126]
    342              
    343          }
   \   00000174   0xBDF7             POP      {R0-R2,R4-R7,PC}  ;; return
    344          
    345          
    346                
    347          /*******************************************************************************
    348           * 名    称：RoadNum;        		StoreData
    349           * 功    能：RelRoadNum;     		数据存储。根据数据记录号将数据存储到指定
    350           			StationNum;    		flash地址;更新记录号等信息。大部分数据记录的
    351           			E_StationNum;  		内容在其他任务直接对sCtrl.sRec 中更新。少部分
    352           					数据内容在该函数中跟新。
    353           * 入口参数：SignalTyp;      	无
    354           * 出口参数：LocoSign;       	无
    355           * 作　 　者                 ： 	redmornigcn
    356           * 创建日期：LocoWorkState;  	2017-05-15
    357           * 修    改：LocoState;     
    358           * 修改日期：
    359           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    360          void  StoreData(void)
    361          {	
   \                     StoreData: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
    362              // 	计算数据记录地址
    363              uint32  FlshAddr = GetRecNumAddr( sCtrl.sRecNumMgr.Current );		
   \   00000002   0x....             LDR.N    R0,??DataTable4
   \   00000004   0x6840             LDR      R0,[R0, #+4]
   \   00000006   0x.... 0x....      BL       GetRecNumAddr
   \   0000000A   0x0004             MOVS     R4,R0
    364              
    365          //    sCtrl.sRunPara.StoreType    = 0x02;           //调试模式
    366          //    sCtrl.sRunPara.StoreTypeBak = 0x02;           //调试模式
    367          
    368              if(sCtrl.sRunPara.StoreType == 0x02 && sCtrl.sRunPara.StoreTypeBak == 0x02)  //NDP02B格式
   \   0000000C   0x....             LDR.N    R0,??DataTable4
   \   0000000E   0xF890 0x00C9      LDRB     R0,[R0, #+201]
   \   00000012   0x2802             CMP      R0,#+2
   \   00000014   0xD10D             BNE.N    ??StoreData_0
   \   00000016   0x....             LDR.N    R0,??DataTable4
   \   00000018   0xF890 0x00CA      LDRB     R0,[R0, #+202]
   \   0000001C   0x2802             CMP      R0,#+2
   \   0000001E   0xD108             BNE.N    ??StoreData_0
    369              {
    370                  SetRecFlsh_NDP02B(&sCtrl.sRecNdp02B);
   \   00000020   0x....             LDR.N    R0,??DataTable4_5
   \   00000022   0x.... 0x....      BL       SetRecFlsh_NDP02B
    371                                                              //	数据存储到flash
    372                  if(!WriteFlsh(FlshAddr, (uint16 *)&sCtrl.sRecNdp02B, sizeof(sCtrl.sRecNdp02B)))
   \   00000026   0x2280             MOVS     R2,#+128
   \   00000028   0x....             LDR.N    R1,??DataTable4_5
   \   0000002A   0x0020             MOVS     R0,R4
   \   0000002C   0x.... 0x....      BL       WriteFlsh
   \   00000030   0xE007             B.N      ??StoreData_1
    373                  {}        
    374              }
    375              else
    376              {
    377                  SetRecFlsh(&sCtrl.sRec);                    //原数据结构
   \                     ??StoreData_0: (+1)
   \   00000032   0x....             LDR.N    R0,??DataTable4_6
   \   00000034   0x.... 0x....      BL       SetRecFlsh
    378                  //	数据存储到flash
    379                  if(!WriteFlsh(FlshAddr, (uint16 *)&sCtrl.sRec, sizeof(sCtrl.sRec)))
   \   00000038   0x2280             MOVS     R2,#+128
   \   0000003A   0x....             LDR.N    R1,??DataTable4_6
   \   0000003C   0x0020             MOVS     R0,R4
   \   0000003E   0x.... 0x....      BL       WriteFlsh
    380                  {}
    381              }
    382              
    383          // 	保存数据记录号
    384              sCtrl.sRecNumMgr.Current++;
   \                     ??StoreData_1: (+1)
   \   00000042   0x....             LDR.N    R0,??DataTable4
   \   00000044   0x6840             LDR      R0,[R0, #+4]
   \   00000046   0x1C40             ADDS     R0,R0,#+1
   \   00000048   0x....             LDR.N    R1,??DataTable4
   \   0000004A   0x6048             STR      R0,[R1, #+4]
    385          	FRAM_StoreRecNumMgr((StrRecNumMgr  *)&sCtrl.sRecNumMgr);    //数据记录号加1，并保存
   \   0000004C   0x....             LDR.N    R0,??DataTable4_7
   \   0000004E   0x.... 0x....      BL       FRAM_StoreRecNumMgr
    386          }
   \   00000052   0xBD10             POP      {R4,PC}          ;; return
    387          
    388          /*******************************************************************************
    389           * 名    称： 		ReadFlshRec
    390           * 功    能： 		根据记录号，取数据记录
    391           * 入口参数： 	    无
    392           * 出口参数： 	    无
    393           * 作　 　者： 	    redmornigcn
    394           * 创建日期： 	    2017-05-15
    395           * 修    改：
    396           * 修改日期：
    397           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    398          uint8	ReadFlshRec(stcFlshRec * sFlshRec,uint32	FlshRecNum)
    399          {
   \                     ReadFlshRec: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0x0004             MOVS     R4,R0
   \   00000004   0x000D             MOVS     R5,R1
    400          	uint32		FlshAddr;
    401          	
    402          	FlshAddr = GetRecNumAddr( FlshRecNum );						
   \   00000006   0x0028             MOVS     R0,R5
   \   00000008   0x.... 0x....      BL       GetRecNumAddr
   \   0000000C   0x0006             MOVS     R6,R0
    403          	
    404          	if(ReadFlsh(FlshAddr,(uint16 *)sFlshRec,sizeof(stcFlshRec)))
   \   0000000E   0x2280             MOVS     R2,#+128
   \   00000010   0x0021             MOVS     R1,R4
   \   00000012   0x0030             MOVS     R0,R6
   \   00000014   0x.... 0x....      BL       ReadFlsh
   \   00000018   0x2800             CMP      R0,#+0
   \   0000001A   0xD001             BEQ.N    ??ReadFlshRec_0
    405          	{
    406          		return 1;
   \   0000001C   0x2001             MOVS     R0,#+1
   \   0000001E   0xE000             B.N      ??ReadFlshRec_1
    407          	}
    408          	
    409          	return	0;
   \                     ??ReadFlshRec_0: (+1)
   \   00000020   0x2000             MOVS     R0,#+0
   \                     ??ReadFlshRec_1: (+1)
   \   00000022   0xBD70             POP      {R4-R6,PC}       ;; return
    410          }
    411          
    412          /*******************************************************************************
    413           * 名    称：  TaskInitStore
    414           * 功    能：  任务初始化
    415           * 入口参数： 	无
    416           * 出口参数： 	无
    417           * 作　 　者： 	redmornigcn
    418           * 创建日期： 	2017-05-15
    419           * 修    改：
    420           * 修改日期：
    421           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    422          void    BSP_StoreInit(void)
    423          {
   \                     BSP_StoreInit: (+1)
   \   00000000   0xB580             PUSH     {R7,LR}
    424          	InitFlashIO();      //初始化flash
   \   00000002   0x.... 0x....      BL       InitFlashIO
    425          
    426              GPIO_Fram_Init();   //初始化fram
   \   00000006   0x.... 0x....      BL       GPIO_Fram_Init
    427              
    428              InitDS3231();       //初始化时钟
   \   0000000A   0x.... 0x....      BL       InitDS3231
    429                  
    430             //读sCtrl 
    431              FRAM_ReadRecNumMgr((StrRecNumMgr  *)&sCtrl.sRecNumMgr);         //读记录号
   \   0000000E   0x....             LDR.N    R0,??DataTable4_7
   \   00000010   0x.... 0x....      BL       FRAM_ReadRecNumMgr
    432              FRAM_ReadProductInfo((StrProductInfo  *)&sCtrl.sProductInfo);   //读产品编号
   \   00000014   0x....             LDR.N    R0,??DataTable4_8
   \   00000016   0x.... 0x....      BL       FRAM_ReadProductInfo
    433              FRAM_ReadCurRecord((stcFlshRec  *)&sCtrl.sRec);                 //读当前记录
   \   0000001A   0x....             LDR.N    R0,??DataTable4_6
   \   0000001C   0x.... 0x....      BL       FRAM_ReadCurRecord
    434              FRAM_ReadOilPara((StrOilPara  *)&sCtrl.SOilPara);               //读计算参数
   \   00000020   0x....             LDR.N    R0,??DataTable4_9
   \   00000022   0x.... 0x....      BL       FRAM_ReadOilPara
    435              FRAM_ReadRunPara((stcRunPara  *)&sCtrl.sRunPara);               //读运行参数
   \   00000026   0x....             LDR.N    R0,??DataTable4_10
   \   00000028   0x.... 0x....      BL       FRAM_ReadRunPara
    436              FRAM_ReadCalcModel((stcCalcModel  *)&sCtrl.sCalcModel);         //读计算模型
   \   0000002C   0x....             LDR.N    R0,??DataTable4_11
   \   0000002E   0x.... 0x....      BL       FRAM_ReadCalcModel
    437          
    438          }
   \   00000032   0xBD01             POP      {R0,PC}          ;; return
    439          
    440          /*******************************************************************************
    441           * 名    称：  TaskInitStore
    442           * 功    能：  任务初始化
    443           * 入口参数： 	无
    444           * 出口参数： 	无
    445           * 作　 　者： 	redmornigcn
    446           * 创建日期： 	2017-05-15
    447           * 修    改：
    448           * 修改日期：
    449           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    450          void TaskInitStore(void)
    451          {    
   \                     TaskInitStore: (+1)
   \   00000000   0xB580             PUSH     {R7,LR}
    452          //    /***********************************************
    453          //    * 描述： 初始化本任务用到的相关硬件
    454          //    */
    455              BSP_StoreInit();			//初始化Flash底层相关函数
   \   00000002   0x.... 0x....      BL       BSP_StoreInit
    456          
    457          //初始化定时器
    458              osal_start_timerEx( OS_TASK_ID_STORE,
    459                                OS_EVT_STORE_TICKS,
    460                                1000);
   \   00000006   0xF44F 0x727A      MOV      R2,#+1000
   \   0000000A   0x2101             MOVS     R1,#+1
   \   0000000C   0x2004             MOVS     R0,#+4
   \   0000000E   0x.... 0x....      BL       osal_start_timerEx
    461          }
   \   00000012   0xBD01             POP      {R0,PC}          ;; return
    462          
    463          extern  MODBUS_CH   *g_pch; 
    464          /*******************************************************************************
    465           * 名    称： 		AppTaskStore
    466           * 功    能： 		控制任务
    467           * 入口参数： 	p_arg - 由任务创建函数传入
    468           * 出口参数： 	无
    469           * 作　 　者： 	redmorningcn.
    470           * 创建日期： 	2017-05-15
    471           * 修    改：
    472           * 修改日期：
    473           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    474          osalEvt  TaskStoreEvtProcess(INT8U task_id, osalEvt task_event)
    475          {
   \                     TaskStoreEvtProcess: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0x0004             MOVS     R4,R0
   \   00000004   0x000D             MOVS     R5,R1
    476              OS_ERR      err;
    477              INT32U      ticks;
    478              INT32S      dly;
    479              CPU_SR_ALLOC();
   \   00000006   0x2600             MOVS     R6,#+0
    480          
    481              if( task_event & OS_EVT_STORE_TICKS ) {
   \   00000008   0x07E8             LSLS     R0,R5,#+31
   \   0000000A   0xD50A             BPL.N    ??TaskStoreEvtProcess_0
    482          
    483                  StoreData();            //保存数据记录
   \   0000000C   0x.... 0x....      BL       StoreData
    484                  
    485                  osal_start_timerEx( OS_TASK_ID_STORE,
    486                                      OS_EVT_STORE_TICKS,
    487                                      1000*60);
   \   00000010   0xF64E 0x2260      MOVW     R2,#+60000
   \   00000014   0x2101             MOVS     R1,#+1
   \   00000016   0x2004             MOVS     R0,#+4
   \   00000018   0x.... 0x....      BL       osal_start_timerEx
    488                                      //1000);
    489                  return ( task_event ^ OS_EVT_STORE_TICKS );
   \   0000001C   0xF095 0x0001      EORS     R0,R5,#0x1
   \   00000020   0xE7FF             B.N      ??TaskStoreEvtProcess_1
    490              }
    491          }
   \                     ??TaskStoreEvtProcess_0: (+1)
   \                     ??TaskStoreEvtProcess_1: (+1)
   \   00000022   0xBD70             POP      {R4-R6,PC}       ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   0x........         DC32     sCtrl

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_1:
   \   00000000   0x........         DC32     sCtrl+0x8BF

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_2:
   \   00000000   0x........         DC32     sCtrl+0x8D0

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_3:
   \   00000000   0x........         DC32     sCtrl+0x8C7

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_4:
   \   00000000   0x........         DC32     sCtrl+0x89E

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_5:
   \   00000000   0x........         DC32     sCtrl+0x8E8

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_6:
   \   00000000   0x........         DC32     sCtrl+0x20

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_7:
   \   00000000   0x........         DC32     sCtrl+0x4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_8:
   \   00000000   0x........         DC32     sCtrl+0x14

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_9:
   \   00000000   0x........         DC32     sCtrl+0xA0

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_10:
   \   00000000   0x........         DC32     sCtrl+0xC4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_11:
   \   00000000   0x........         DC32     sCtrl+0xCC
    492          
    493          
    494          
    495          /*******************************************************************************
    496           * 				                    end of file                                *
    497           *******************************************************************************/
    498          #endif

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       8   BSP_StoreInit
         8   -> FRAM_ReadCalcModel
         8   -> FRAM_ReadCurRecord
         8   -> FRAM_ReadOilPara
         8   -> FRAM_ReadProductInfo
         8   -> FRAM_ReadRecNumMgr
         8   -> FRAM_ReadRunPara
         8   -> GPIO_Fram_Init
         8   -> InitDS3231
         8   -> InitFlashIO
       0   GetRecNumAddr
      40   GetTaxInfoToRecord
        40   -> __aeabi_memcpy
      16   ReadFlshRec
        16   -> GetRecNumAddr
        16   -> ReadFlsh
      16   SetRecFlsh
        16   -> GetCrc16Check
        16   -> GetTaxInfoToRecord
        16   -> ReadTime
      32   SetRecFlsh_NDP02B
        32   -> GetCrc16Check
        32   -> ReadTime
        32   -> __aeabi_memcpy
        32   -> __aeabi_memset
       8   StoreData
         8   -> FRAM_StoreRecNumMgr
         8   -> GetRecNumAddr
         8   -> SetRecFlsh
         8   -> SetRecFlsh_NDP02B
         8   -> WriteFlsh
       8   TaskInitStore
         8   -> BSP_StoreInit
         8   -> osal_start_timerEx
      16   TaskStoreEvtProcess
        16   -> StoreData
        16   -> osal_start_timerEx


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable4
       4  ??DataTable4_1
       4  ??DataTable4_10
       4  ??DataTable4_11
       4  ??DataTable4_2
       4  ??DataTable4_3
       4  ??DataTable4_4
       4  ??DataTable4_5
       4  ??DataTable4_6
       4  ??DataTable4_7
       4  ??DataTable4_8
       4  ??DataTable4_9
      52  BSP_StoreInit
      20  GetRecNumAddr
     320  GetTaxInfoToRecord
      36  ReadFlshRec
     230  SetRecFlsh
     374  SetRecFlsh_NDP02B
      84  StoreData
      20  TaskInitStore
      36  TaskStoreEvtProcess

 
 1 220 bytes in section .text
 
 1 220 bytes of CODE memory

Errors: none
Warnings: 19
