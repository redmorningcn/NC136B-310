###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.1.10123/W32 for ARM       21/Aug/2017  11:49:41
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_mtr.c
#    Command line =  
#        F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_mtr.c -lCN
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List
#        --diag_suppress Pa050 -o
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M3 -e --fpu=None --dlib_config "C:\Program Files
#        (x86)\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Normal.h" -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\BSP\OS\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\LPC1768\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CSP\MCU\NXP\LPC17xx\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\Generic\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Ports\ARM-Cortex-M3\CSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uCOS-III\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-LIB\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-CPU\ARM-Cortex-M3\IAR\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Source\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Cfg\Template\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\uC-MB\Os\uCOS-III\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\OS\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\OSAL\Ports\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Iap\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Protocol\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\Tasks\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\APP\AES\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\OS\OSAL\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\CSB\include\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\BSP\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\MX25L1602Drv\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\APP\OCM800600T80\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\User\BSP\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\CardOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\DataDeal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Driver\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\EquipmentOperations\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\Global\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\MastConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SlaveConTask\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\SpeedTest\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\csnr_package_deal\
#        -I
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\..\..\..\..\..\..\Application\Library\iap\
#        -On --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.3\arm\CMSIS\Include\"
#    List file    =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\List\app_comm_mtr.lst
#    Object file  =  
#        F:\iar\NC136B-310统计模块\Software\EvalBoards\NXP\LPC1768-SK\uCOS-III\IAR\FLASH\Obj\app_comm_mtr.o
#
###############################################################################

F:\iar\NC136B-310统计模块\Software\APP\comm\app_comm_mtr.c
      1          
      2          /*******************************************************************************
      3           *   Filename:       app_comm_mtr.c
      4           *   Revised:        All copyrights reserved to wumingshen.
      5           *   Revision:       v1.0
      6           *   Writer:	     redmorningcn.
      7           *
      8           *   Description:    双击选中 comm 按 Ctrl + H, 钩选 Match the case, Replace with
      9           *                   输入您要的名字，点击 Replace All
     10           *                   双击选中 Comm 按 Ctrl + H, 钩选 Match the case, Replace with
     11           *                   输入您要的名字，点击 Replace All
     12           *                   双击选中 COMM 按 Ctrl + H, 钩选 Match the case, Replace with
     13           *                   输入您要的名字，点击 Replace All
     14           *                   在 app_cfg.h 中指定本任务的 优先级  （ APP_TASK_COMM_PRIO     ）
     15           *                                            和 任务堆栈（ APP_TASK_COMM_STK_SIZE ）大小
     16           *
     17           *   Notes:
     18           *     				E-mail: redmorningcn@qq.com
     19           *
     20           *******************************************************************************/
     21          
     22          /*******************************************************************************
     23           * INCLUDES
     24           */
     25          #define  SNL_APP_SOURCE
     26          #include <includes.h>
     27          #include <app_comm_protocol.h>
     28          #include <app_ctrl.h>
     29          #include <app.h>
     30          #include <os_cfg_app.h>
     31          
     32          #ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
     33          const  CPU_CHAR  *app_comm_mtr__c = "$Id: $";
     34          #endif
     35          
     36          #define APP_TASK_COMM_EN     DEF_ENABLED
     37          #if APP_TASK_COMM_EN == DEF_ENABLED
     38          /*******************************************************************************
     39           * CONSTANTS
     40           */
     41          
     42          /*******************************************************************************
     43           * MACROS
     44           */
     45          #define CYCLE_TIME_TICKS            (OS_TICKS_PER_SEC * 1)
     46          
     47          /*******************************************************************************
     48           * TYPEDEFS
     49           */
     50          
     51          
     52          /*******************************************************************************
     53           * LOCAL VARIABLES
     54           */
     55          
     56          /*******************************************************************************
     57           * GLOBAL VARIABLES
     58           */
     59          
     60          /***********************************************
     61          * 描述： 软定时器声明
     62          */
     63          
     64          /***********************************************
     65          * 描述： 软定时器回调函数
     66          */
     67          
     68          
     69          /*******************************************************************************
     70           * LOCAL FUNCTIONS
     71           */
     72          
     73          
     74          
     75          /*******************************************************************************
     76           * GLOBAL FUNCTIONS
     77           */
     78          
     79          /*******************************************************************************
     80           * EXTERN VARIABLES
     81           */
     82          
     83           /*******************************************************************************
     84           * EXTERN FUNCTIONS
     85           */
     86          
     87          /*******************************************************************************/
     88          
     89          
     90          /*******************************************************************************
     91           * 名    称： app_comm_mtr
     92           * 功    能： 调用油尺通讯处理函数。
     93           *            如果是定时器超时，则对应地址的timeout计算加1，并判断
     94           *            值是否到满足该地址故障判断次数，是否执行通讯异常处理。
     95           *            如果是接收到数据事件，则根据接收数据进行处理。
     96           * 入口参数： 无
     97           * 出口参数： 无
     98           * 作　 　者： redmorningcn.
     99           * 创建日期： 2017-05-18
    100           * 修    改：
    101           * 修改日期：
    102           * 备    注： 任务创建函数需要在app.h文件中声明
    103           *******************************************************************************/

   \                                 In section .text, align 4, keep-with-next
    104          void    app_comm_mtr(void)
    105          {
   \                     app_comm_mtr: (+1)
   \   00000000   0xB5FE             PUSH     {R1-R7,LR}
    106              //判断对应地址连接是否接收到数据
    107              static  uint8   sendtimes = 0;
    108              uint8 i = 0;
   \   00000002   0x2400             MOVS     R4,#+0
    109              while(i < COMM_DEV_MTR_CONN_NUM){
   \                     ??app_comm_mtr_0: (+1)
   \   00000004   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000006   0x2C02             CMP      R4,#+2
   \   00000008   0xF280 0x807F      BGE.W    ??app_comm_mtr_1
    110                  if(sCtrl.Mtr.ConnCtrl[i].RecvEndFlg ==  1 )   //如果地址i接收到数据，对数据进行处理
   \   0000000C   0x488D             LDR.N    R0,??app_comm_mtr_2
   \   0000000E   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000010   0xEB10 0x00C4      ADDS     R0,R0,R4, LSL #+3
   \   00000014   0xF890 0x0399      LDRB     R0,[R0, #+921]
   \   00000018   0x2801             CMP      R0,#+1
   \   0000001A   0xD174             BNE.N    ??app_comm_mtr_3
    111                  {
    112                      /***********************************************
    113                      * 描述： 从接收的revcbuf中取数据
    114                      */
    115                      
    116                      if(sCtrl.Mtr.RxCtrl.SourceAddr == SLAVE_ADDR_DIP1)    //测量装置1，
   \   0000001C   0x4889             LDR.N    R0,??app_comm_mtr_2
   \   0000001E   0xF890 0x038D      LDRB     R0,[R0, #+909]
   \   00000022   0x28A1             CMP      R0,#+161
   \   00000024   0xD12D             BNE.N    ??app_comm_mtr_4
    117                      {
    118                          //高度
    119                          sCtrl.sRec.Myhig1   =   sCtrl.Mtr.Rd.sRecv.Hight/256 
    120                                              +   (sCtrl.Mtr.Rd.sRecv.Hight %256)*256;   
   \   00000026   0x4887             LDR.N    R0,??app_comm_mtr_2
   \   00000028   0xF8B0 0x024C      LDRH     R0,[R0, #+588]
   \   0000002C   0xF44F 0x7180      MOV      R1,#+256
   \   00000030   0xFB90 0xF0F1      SDIV     R0,R0,R1
   \   00000034   0x4983             LDR.N    R1,??app_comm_mtr_2
   \   00000036   0xF8B1 0x124C      LDRH     R1,[R1, #+588]
   \   0000003A   0xF44F 0x7280      MOV      R2,#+256
   \   0000003E   0xFB91 0xF3F2      SDIV     R3,R1,R2
   \   00000042   0xFB03 0x1312      MLS      R3,R3,R2,R1
   \   00000046   0xF44F 0x7180      MOV      R1,#+256
   \   0000004A   0xFB01 0x0003      MLA      R0,R1,R3,R0
   \   0000004E   0x497D             LDR.N    R1,??app_comm_mtr_2
   \   00000050   0xF8A1 0x0064      STRH     R0,[R1, #+100]
    121                          //密度值
    122                          sCtrl.sRec.MyDip1Den=    sCtrl.Mtr.Rd.sRecv.Density/256 
    123                                              +   (sCtrl.Mtr.Rd.sRecv.Density %256)*256;   
   \   00000054   0x487B             LDR.N    R0,??app_comm_mtr_2
   \   00000056   0xF8B0 0x024E      LDRH     R0,[R0, #+590]
   \   0000005A   0xF44F 0x7180      MOV      R1,#+256
   \   0000005E   0xFB90 0xF0F1      SDIV     R0,R0,R1
   \   00000062   0x4978             LDR.N    R1,??app_comm_mtr_2
   \   00000064   0xF8B1 0x124E      LDRH     R1,[R1, #+590]
   \   00000068   0xF44F 0x7280      MOV      R2,#+256
   \   0000006C   0xFB91 0xF3F2      SDIV     R3,R1,R2
   \   00000070   0xFB03 0x1312      MLS      R3,R3,R2,R1
   \   00000074   0xF44F 0x7180      MOV      R1,#+256
   \   00000078   0xFB01 0x0003      MLA      R0,R1,R3,R0
   \   0000007C   0x4971             LDR.N    R1,??app_comm_mtr_2
   \   0000007E   0xF8A1 0x008C      STRH     R0,[R1, #+140]
    124                      }
    125                      
    126                      if(sCtrl.Mtr.RxCtrl.SourceAddr == SLAVE_ADDR_DIP2)    //测量装置2，
   \                     ??app_comm_mtr_4: (+1)
   \   00000082   0x4870             LDR.N    R0,??app_comm_mtr_2
   \   00000084   0xF890 0x038D      LDRB     R0,[R0, #+909]
   \   00000088   0x28A2             CMP      R0,#+162
   \   0000008A   0xD12D             BNE.N    ??app_comm_mtr_5
    127                      {   //高度值    
    128                          sCtrl.sRec.Myhig2   =   sCtrl.Mtr.Rd.sRecv.Hight/256 
    129                                                  +   (sCtrl.Mtr.Rd.sRecv.Hight %256)*256;      
   \   0000008C   0x486D             LDR.N    R0,??app_comm_mtr_2
   \   0000008E   0xF8B0 0x024C      LDRH     R0,[R0, #+588]
   \   00000092   0xF44F 0x7180      MOV      R1,#+256
   \   00000096   0xFB90 0xF0F1      SDIV     R0,R0,R1
   \   0000009A   0x496A             LDR.N    R1,??app_comm_mtr_2
   \   0000009C   0xF8B1 0x124C      LDRH     R1,[R1, #+588]
   \   000000A0   0xF44F 0x7280      MOV      R2,#+256
   \   000000A4   0xFB91 0xF3F2      SDIV     R3,R1,R2
   \   000000A8   0xFB03 0x1312      MLS      R3,R3,R2,R1
   \   000000AC   0xF44F 0x7180      MOV      R1,#+256
   \   000000B0   0xFB01 0x0003      MLA      R0,R1,R3,R0
   \   000000B4   0x4963             LDR.N    R1,??app_comm_mtr_2
   \   000000B6   0xF8A1 0x0066      STRH     R0,[R1, #+102]
    130                          //密度
    131                          sCtrl.sRec.MyDip2Den=   sCtrl.Mtr.Rd.sRecv.Density/256 
    132                                              +   (sCtrl.Mtr.Rd.sRecv.Density %256)*256;   
   \   000000BA   0x4862             LDR.N    R0,??app_comm_mtr_2
   \   000000BC   0xF8B0 0x024E      LDRH     R0,[R0, #+590]
   \   000000C0   0xF44F 0x7180      MOV      R1,#+256
   \   000000C4   0xFB90 0xF0F1      SDIV     R0,R0,R1
   \   000000C8   0x495E             LDR.N    R1,??app_comm_mtr_2
   \   000000CA   0xF8B1 0x124E      LDRH     R1,[R1, #+590]
   \   000000CE   0xF44F 0x7280      MOV      R2,#+256
   \   000000D2   0xFB91 0xF3F2      SDIV     R3,R1,R2
   \   000000D6   0xFB03 0x1312      MLS      R3,R3,R2,R1
   \   000000DA   0xF44F 0x7180      MOV      R1,#+256
   \   000000DE   0xFB01 0x0003      MLA      R0,R1,R3,R0
   \   000000E2   0x4958             LDR.N    R1,??app_comm_mtr_2
   \   000000E4   0xF8A1 0x008E      STRH     R0,[R1, #+142]
    133                      }
    134                      
    135                      sCtrl.Mtr.ConnCtrl[i].RecvEndFlg = 0;                   
   \                     ??app_comm_mtr_5: (+1)
   \   000000E8   0x2000             MOVS     R0,#+0
   \   000000EA   0x4956             LDR.N    R1,??app_comm_mtr_2
   \   000000EC   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   000000EE   0xEB11 0x01C4      ADDS     R1,R1,R4, LSL #+3
   \   000000F2   0xF881 0x0399      STRB     R0,[R1, #+921]
    136                      sCtrl.Mtr.ConnCtrl[i].TimeOut    = 0; 
   \   000000F6   0x2000             MOVS     R0,#+0
   \   000000F8   0x4952             LDR.N    R1,??app_comm_mtr_2
   \   000000FA   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   000000FC   0xEB11 0x01C4      ADDS     R1,R1,R4, LSL #+3
   \   00000100   0xF881 0x039A      STRB     R0,[R1, #+922]
    137                      
    138                      return  ;
   \   00000104   0xE09C             B.N      ??app_comm_mtr_6
    139                  }
    140                  
    141                  i++;
   \                     ??app_comm_mtr_3: (+1)
   \   00000106   0x1C64             ADDS     R4,R4,#+1
   \   00000108   0xE77C             B.N      ??app_comm_mtr_0
    142              }
    143           
    144              /***********************************************
    145              * 描述： 如果是超时。
    146              *1. 超时时，所有地址计算加1，对应计算器在收到数据时清零。
    147              *2. 发送下个地址的数据。
    148              */
    149              if( sCtrl.Os.CommEvtFlag |  COMM_EVT_FLAG_MTR_TIMEOUT){
    150                  uint8 i = 0;
   \                     ??app_comm_mtr_1: (+1)
   \   0000010A   0x2500             MOVS     R5,#+0
    151                  while( i < COMM_DEV_MTR_CONN_NUM){
   \                     ??app_comm_mtr_7: (+1)
   \   0000010C   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000010E   0x2D02             CMP      R5,#+2
   \   00000110   0xDA44             BGE.N    ??app_comm_mtr_8
    152                      sCtrl.Mtr.ConnCtrl[i].TimeOut++;
   \   00000112   0x484C             LDR.N    R0,??app_comm_mtr_2
   \   00000114   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000116   0xEB10 0x00C5      ADDS     R0,R0,R5, LSL #+3
   \   0000011A   0xF890 0x039A      LDRB     R0,[R0, #+922]
   \   0000011E   0x1C40             ADDS     R0,R0,#+1
   \   00000120   0x4948             LDR.N    R1,??app_comm_mtr_2
   \   00000122   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000124   0xEB11 0x01C5      ADDS     R1,R1,R5, LSL #+3
   \   00000128   0xF881 0x039A      STRB     R0,[R1, #+922]
    153                      //超时数大于10次，5S，报通讯错误。
    154                      if(sCtrl.Mtr.ConnCtrl[i].TimeOut > 10 * COMM_DEV_MTR_CONN_NUM){
   \   0000012C   0x4845             LDR.N    R0,??app_comm_mtr_2
   \   0000012E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000130   0xEB10 0x00C5      ADDS     R0,R0,R5, LSL #+3
   \   00000134   0xF890 0x039A      LDRB     R0,[R0, #+922]
   \   00000138   0x2815             CMP      R0,#+21
   \   0000013A   0xDB26             BLT.N    ??app_comm_mtr_9
    155                          
    156                          sCtrl.Mtr.ConnCtrl[i].TimeOut = 10 * COMM_DEV_MTR_CONN_NUM + 1;
   \   0000013C   0x2015             MOVS     R0,#+21
   \   0000013E   0x4941             LDR.N    R1,??app_comm_mtr_2
   \   00000140   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000142   0xEB11 0x01C5      ADDS     R1,R1,R5, LSL #+3
   \   00000146   0xF881 0x039A      STRB     R0,[R1, #+922]
    157                          sCtrl.Mtr.ConnCtrl[i].ErrFlg = 1;       
   \   0000014A   0x2001             MOVS     R0,#+1
   \   0000014C   0x493D             LDR.N    R1,??app_comm_mtr_2
   \   0000014E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000150   0xEB11 0x01C5      ADDS     R1,R1,R5, LSL #+3
   \   00000154   0xF881 0x039B      STRB     R0,[R1, #+923]
    158                          
    159                          //数据清零
    160                          if(sCtrl.Mtr.ConnCtrl[i].SlaveAddr == SLAVE_ADDR_DIP1)  
   \   00000158   0x483A             LDR.N    R0,??app_comm_mtr_2
   \   0000015A   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000015C   0xEB10 0x00C5      ADDS     R0,R0,R5, LSL #+3
   \   00000160   0xF890 0x039C      LDRB     R0,[R0, #+924]
   \   00000164   0x28A1             CMP      R0,#+161
   \   00000166   0xD103             BNE.N    ??app_comm_mtr_10
    161                              sCtrl.sRec.Myhig1 = 0;
   \   00000168   0x2000             MOVS     R0,#+0
   \   0000016A   0x4936             LDR.N    R1,??app_comm_mtr_2
   \   0000016C   0xF8A1 0x0064      STRH     R0,[R1, #+100]
    162          
    163                          if(sCtrl.Mtr.ConnCtrl[i].SlaveAddr == SLAVE_ADDR_DIP2)  
   \                     ??app_comm_mtr_10: (+1)
   \   00000170   0x4834             LDR.N    R0,??app_comm_mtr_2
   \   00000172   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000174   0xEB10 0x00C5      ADDS     R0,R0,R5, LSL #+3
   \   00000178   0xF890 0x039C      LDRB     R0,[R0, #+924]
   \   0000017C   0x28A2             CMP      R0,#+162
   \   0000017E   0xD10B             BNE.N    ??app_comm_mtr_11
    164                              sCtrl.sRec.Myhig2 = 0;                
   \   00000180   0x2000             MOVS     R0,#+0
   \   00000182   0x4930             LDR.N    R1,??app_comm_mtr_2
   \   00000184   0xF8A1 0x0066      STRH     R0,[R1, #+102]
   \   00000188   0xE006             B.N      ??app_comm_mtr_11
    165                      }else{
    166                          //接收到数据，通讯清零
    167                          sCtrl.Mtr.ConnCtrl[i].ErrFlg = 0;                       
   \                     ??app_comm_mtr_9: (+1)
   \   0000018A   0x2000             MOVS     R0,#+0
   \   0000018C   0x492D             LDR.N    R1,??app_comm_mtr_2
   \   0000018E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000190   0xEB11 0x01C5      ADDS     R1,R1,R5, LSL #+3
   \   00000194   0xF881 0x039B      STRB     R0,[R1, #+923]
    168                      }
    169                      
    170                      i++;
   \                     ??app_comm_mtr_11: (+1)
   \   00000198   0x1C6D             ADDS     R5,R5,#+1
   \   0000019A   0xE7B7             B.N      ??app_comm_mtr_7
    171                  }
    172                  
    173                  /***********************************************
    174                  * 描述： 如果是超时。
    175                  * 发送下个地址的数据。准备数据，发送下一个数据。
    176                  */ 
    177                  //前4位是油量，高低位掉头
    178                  sCtrl.Mtr.Wr.Buf[0] = sCtrl.sRec.MstDip>>24;
   \                     ??app_comm_mtr_8: (+1)
   \   0000019C   0x4829             LDR.N    R0,??app_comm_mtr_2
   \   0000019E   0x6D40             LDR      R0,[R0, #+84]
   \   000001A0   0x0E00             LSRS     R0,R0,#+24
   \   000001A2   0x4928             LDR.N    R1,??app_comm_mtr_2
   \   000001A4   0xF881 0x02EC      STRB     R0,[R1, #+748]
    179                  sCtrl.Mtr.Wr.Buf[1] = sCtrl.sRec.MstDip>>16;
   \   000001A8   0x4826             LDR.N    R0,??app_comm_mtr_2
   \   000001AA   0x6D40             LDR      R0,[R0, #+84]
   \   000001AC   0x0C00             LSRS     R0,R0,#+16
   \   000001AE   0x4925             LDR.N    R1,??app_comm_mtr_2
   \   000001B0   0xF881 0x02ED      STRB     R0,[R1, #+749]
    180                  sCtrl.Mtr.Wr.Buf[2] = sCtrl.sRec.MstDip>>8;
   \   000001B4   0x4823             LDR.N    R0,??app_comm_mtr_2
   \   000001B6   0x6D40             LDR      R0,[R0, #+84]
   \   000001B8   0x0A00             LSRS     R0,R0,#+8
   \   000001BA   0x4922             LDR.N    R1,??app_comm_mtr_2
   \   000001BC   0xF881 0x02EE      STRB     R0,[R1, #+750]
    181                  sCtrl.Mtr.Wr.Buf[3] = sCtrl.sRec.MstDip>>0;
   \   000001C0   0x4820             LDR.N    R0,??app_comm_mtr_2
   \   000001C2   0x6D40             LDR      R0,[R0, #+84]
   \   000001C4   0x491F             LDR.N    R1,??app_comm_mtr_2
   \   000001C6   0xF881 0x02EF      STRB     R0,[R1, #+751]
    182          
    183                  sCtrl.Mtr.Wr.StrSend.Speed = 0;
   \   000001CA   0x2000             MOVS     R0,#+0
   \   000001CC   0x491D             LDR.N    R1,??app_comm_mtr_2
   \   000001CE   0xF8A1 0x02F2      STRH     R0,[R1, #+754]
    184                  sCtrl.Mtr.Wr.StrSend.Accelerations = 0;
   \   000001D2   0x2000             MOVS     R0,#+0
   \   000001D4   0x491B             LDR.N    R1,??app_comm_mtr_2
   \   000001D6   0xF8A1 0x02F0      STRH     R0,[R1, #+752]
    185                  sCtrl.Mtr.Wr.StrSend.Density = 0;
   \   000001DA   0x2000             MOVS     R0,#+0
   \   000001DC   0x4919             LDR.N    R1,??app_comm_mtr_2
   \   000001DE   0xF8A1 0x02F5      STRH     R0,[R1, #+757]
    186                  //sCtrl.Mtr.Wr.StrSend.Work = 0;
    187                  //sCtrl.Mtr.Wr.StrSend.Rsv = 0;
    188                  
    189                  
    190                                          //需增加串口是否占用判断。    查询标示将会 影响通讯效率（等待调度），采用信号量 （接收开始时（接收计数器为0）
    191                                          //，占用串口；在接收超时时，释放信号）
    192                  sendtimes++;            //发送次数，用于切换地址
   \   000001E2   0x4819             LDR.N    R0,??app_comm_mtr_2+0x4
   \   000001E4   0x7800             LDRB     R0,[R0, #+0]
   \   000001E6   0x1C40             ADDS     R0,R0,#+1
   \   000001E8   0x4917             LDR.N    R1,??app_comm_mtr_2+0x4
   \   000001EA   0x7008             STRB     R0,[R1, #+0]
    193                  //sendtimes = 0;
    194                  CSNC_SendData(sCtrl.Mtr.pch,                                                        //MTR 的PCH：串口号，收发控制等底层信息
    195                                sCtrl.Mtr.ConnCtrl[sendtimes % COMM_DEV_MTR_CONN_NUM].MasterAddr,     //源地址，
    196                                sCtrl.Mtr.ConnCtrl[sendtimes % COMM_DEV_MTR_CONN_NUM].SlaveAddr,      //目标地址
    197                                sendtimes/COMM_DEV_MTR_CONN_NUM,                                      //帧序号
    198                                0,                                                                    //命令字
    199                                (uint8 *)&sCtrl.Mtr.Wr.StrSend,                                       //数据区
    200                                sizeof(sCtrl.Mtr.Wr.StrSend)                                         //发送长度
    201                                );
   \   000001EC   0x2016             MOVS     R0,#+22
   \   000001EE   0x9002             STR      R0,[SP, #+8]
   \   000001F0   0x4816             LDR.N    R0,??app_comm_mtr_2+0x8
   \   000001F2   0x9001             STR      R0,[SP, #+4]
   \   000001F4   0x2000             MOVS     R0,#+0
   \   000001F6   0x9000             STR      R0,[SP, #+0]
   \   000001F8   0x4813             LDR.N    R0,??app_comm_mtr_2+0x4
   \   000001FA   0x7800             LDRB     R0,[R0, #+0]
   \   000001FC   0x2102             MOVS     R1,#+2
   \   000001FE   0xFB90 0xF0F1      SDIV     R0,R0,R1
   \   00000202   0x0003             MOVS     R3,R0
   \   00000204   0xB2DB             UXTB     R3,R3            ;; ZeroExt  R3,R3,#+24,#+24
   \   00000206   0x480F             LDR.N    R0,??app_comm_mtr_2
   \   00000208   0x490F             LDR.N    R1,??app_comm_mtr_2+0x4
   \   0000020A   0x7809             LDRB     R1,[R1, #+0]
   \   0000020C   0x2202             MOVS     R2,#+2
   \   0000020E   0xFB91 0xF6F2      SDIV     R6,R1,R2
   \   00000212   0xFB06 0x1612      MLS      R6,R6,R2,R1
   \   00000216   0xEB10 0x00C6      ADDS     R0,R0,R6, LSL #+3
   \   0000021A   0xF890 0x239C      LDRB     R2,[R0, #+924]
   \   0000021E   0x4809             LDR.N    R0,??app_comm_mtr_2
   \   00000220   0x4909             LDR.N    R1,??app_comm_mtr_2+0x4
   \   00000222   0x7809             LDRB     R1,[R1, #+0]
   \   00000224   0x2602             MOVS     R6,#+2
   \   00000226   0xFB91 0xF7F6      SDIV     R7,R1,R6
   \   0000022A   0xFB07 0x1716      MLS      R7,R7,R6,R1
   \   0000022E   0xEB10 0x00C7      ADDS     R0,R0,R7, LSL #+3
   \   00000232   0xF890 0x139D      LDRB     R1,[R0, #+925]
   \   00000236   0x4803             LDR.N    R0,??app_comm_mtr_2
   \   00000238   0xF8D0 0x03A8      LDR      R0,[R0, #+936]
   \   0000023C   0x.... 0x....      BL       CSNC_SendData
    202                  return;
   \                     ??app_comm_mtr_6: (+1)
   \   00000240   0xBDF7             POP      {R0-R2,R4-R7,PC}  ;; return
   \   00000242   0xBF00             Nop      
   \                     ??app_comm_mtr_2:
   \   00000244   0x........         DC32     sCtrl
   \   00000248   0x........         DC32     ??sendtimes
   \   0000024C   0x........         DC32     sCtrl+0x2EC
    203              }
    204          }

   \                                 In section .bss, align 1
   \                     ??sendtimes:
   \   00000000                      DS8 1
    205          
    206          
    207          /*******************************************************************************
    208           * 				end of file
    209           *******************************************************************************/
    210          #endif

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      32   app_comm_mtr
        32   -> CSNC_SendData


   Section sizes:

   Bytes  Function/Label
   -----  --------------
     592  app_comm_mtr
       1  sendtimes

 
   1 byte  in section .bss
 592 bytes in section .text
 
 592 bytes of CODE memory
   1 byte  of DATA memory

Errors: none
Warnings: none
